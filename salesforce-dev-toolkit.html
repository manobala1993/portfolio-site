<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SF Dev Toolkit</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Unbounded:wght@300;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --sf-blue: #00A1E0;
    --sf-cloud: #032D60;
    --sf-lightning: #FFB75D;
    --sf-green: #04844B;
    --sf-red: #C23934;
    --sf-purple: #7B5EA7;
    --bg: #050E1A;
    --surface: #0A1929;
    --surface2: #0D2137;
    --border: rgba(0,161,224,0.18);
    --text: #E8F4FD;
    --muted: #7BA6BF;
    --mono: 'Space Mono', monospace;
    --display: 'Unbounded', sans-serif;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    min-height: 100vh;
    overflow-x: hidden;
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,161,224,0.12) 0%, transparent 60%),
      repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,161,224,0.04) 40px),
      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,161,224,0.04) 40px);
  }

  /* HEADER */
  .header {
    border-bottom: 1px solid var(--border);
    padding: 20px 32px;
    display: flex;
    align-items: center;
    gap: 16px;
    background: rgba(5,14,26,0.9);
    backdrop-filter: blur(12px);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo-ring {
    width: 38px; height: 38px;
    border: 2px solid var(--sf-blue);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    animation: pulse-ring 3s ease-in-out infinite;
    flex-shrink: 0;
  }

  @keyframes pulse-ring {
    0%, 100% { box-shadow: 0 0 0 0 rgba(0,161,224,0.4); }
    50% { box-shadow: 0 0 0 8px rgba(0,161,224,0); }
  }

  .header-title {
    font-family: var(--display);
    font-weight: 900;
    font-size: 15px;
    letter-spacing: 0.08em;
    color: var(--sf-blue);
  }
  .header-sub { color: var(--muted); font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; }

  .version-badge {
    margin-left: auto;
    background: rgba(0,161,224,0.1);
    border: 1px solid var(--border);
    color: var(--sf-blue);
    font-size: 9px;
    letter-spacing: 0.15em;
    padding: 4px 10px;
    border-radius: 2px;
    text-transform: uppercase;
  }

  /* MAIN LAYOUT */
  .layout { display: grid; grid-template-columns: 220px 1fr; min-height: calc(100vh - 70px); }

  /* SIDEBAR */
  .sidebar {
    border-right: 1px solid var(--border);
    padding: 24px 0;
    background: rgba(10,25,41,0.7);
    backdrop-filter: blur(8px);
    position: sticky;
    top: 70px;
    height: calc(100vh - 70px);
    overflow-y: auto;
  }

  .sidebar-section {
    padding: 6px 16px 2px;
    font-size: 9px;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
    margin-top: 16px;
  }
  .sidebar-section:first-child { margin-top: 0; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    cursor: pointer;
    color: var(--muted);
    font-size: 12px;
    transition: all 0.15s;
    border-left: 2px solid transparent;
    letter-spacing: 0.02em;
  }
  .nav-item:hover { color: var(--text); background: rgba(0,161,224,0.06); }
  .nav-item.active {
    color: var(--sf-blue);
    border-left-color: var(--sf-blue);
    background: rgba(0,161,224,0.1);
  }
  .nav-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }

  /* CONTENT */
  .content { padding: 36px 40px; max-width: 960px; }

  .panel { display: none; animation: fadeIn 0.3s ease; }
  .panel.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .panel-header {
    margin-bottom: 32px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  .panel-eyebrow {
    font-size: 9px;
    letter-spacing: 0.25em;
    color: var(--sf-blue);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .panel-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 24px;
    color: var(--text);
    line-height: 1.2;
  }
  .panel-desc { color: var(--muted); margin-top: 10px; line-height: 1.7; font-size: 12px; }

  /* CODE BLOCKS */
  .code-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 24px;
    overflow: hidden;
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }

  .code-label {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--sf-blue);
    font-family: var(--display);
    font-weight: 700;
  }

  .code-tag {
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 2px;
    letter-spacing: 0.1em;
  }
  .tag-apex { background: rgba(0,161,224,0.15); color: var(--sf-blue); border: 1px solid rgba(0,161,224,0.3); }
  .tag-soql { background: rgba(4,132,75,0.15); color: #06D670; border: 1px solid rgba(4,132,75,0.3); }
  .tag-lwc { background: rgba(255,183,93,0.15); color: var(--sf-lightning); border: 1px solid rgba(255,183,93,0.3); }
  .tag-warn { background: rgba(194,57,52,0.15); color: #FF6B6B; border: 1px solid rgba(194,57,52,0.3); }
  .tag-good { background: rgba(4,132,75,0.15); color: #06D670; border: 1px solid rgba(4,132,75,0.3); }
  .tag-info { background: rgba(123,94,167,0.15); color: #B89DDF; border: 1px solid rgba(123,94,167,0.3); }

  pre {
    padding: 20px;
    overflow-x: auto;
    line-height: 1.75;
    font-size: 12px;
    font-family: var(--mono);
  }

  .kw { color: #7FD1FF; }
  .str { color: #A8FF78; }
  .num { color: var(--sf-lightning); }
  .cmt { color: #4A6D84; font-style: italic; }
  .cls { color: #FFB3E6; }
  .met { color: #79D9F8; }
  .ann { color: #B89DDF; }
  .op { color: var(--muted); }

  /* GOVERNOR LIMITS TABLE */
  .limits-grid {
    display: grid;
    gap: 12px;
    margin-bottom: 24px;
  }

  .limit-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 16px;
    padding: 14px 18px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    transition: border-color 0.2s;
  }
  .limit-row:hover { border-color: rgba(0,161,224,0.4); }

  .limit-name { font-size: 12px; color: var(--text); }
  .limit-desc { font-size: 10px; color: var(--muted); margin-top: 2px; }

  .limit-val {
    font-family: var(--display);
    font-weight: 700;
    font-size: 15px;
    text-align: right;
    white-space: nowrap;
  }
  .limit-bar-wrap { width: 80px; height: 4px; background: rgba(255,255,255,0.06); border-radius: 2px; }
  .limit-bar { height: 100%; border-radius: 2px; }

  /* PATTERN CARDS */
  .pattern-grid { display: grid; gap: 20px; }

  .pattern-card {
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    background: var(--surface);
    transition: border-color 0.2s, transform 0.2s;
  }
  .pattern-card:hover { border-color: rgba(0,161,224,0.4); transform: translateY(-2px); }

  .pattern-top {
    padding: 16px 20px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
  }

  .pattern-name { font-family: var(--display); font-weight: 700; font-size: 14px; color: var(--text); }
  .pattern-why { font-size: 11px; color: var(--muted); margin-top: 4px; line-height: 1.6; }

  /* CHECKLIST */
  .checklist { list-style: none; display: grid; gap: 8px; }
  .check-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 12px;
    line-height: 1.6;
  }
  .check-icon { flex-shrink: 0; margin-top: 1px; }
  .check-icon.pass { color: #06D670; }
  .check-icon.warn { color: var(--sf-lightning); }
  .check-icon.fail { color: #FF6B6B; }

  /* SEARCH BAR */
  .search-wrap {
    position: relative;
    margin-bottom: 24px;
  }
  .search-input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 12px 16px 12px 40px;
    border-radius: 4px;
    outline: none;
    transition: border-color 0.2s;
    letter-spacing: 0.05em;
  }
  .search-input:focus { border-color: var(--sf-blue); }
  .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 14px; }

  /* SOQL BUILDER */
  .soql-builder {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .soql-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }

  .field-group { display: flex; flex-direction: column; gap: 6px; }
  .field-label { font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }
  .field-select, .field-input {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 9px 12px;
    border-radius: 3px;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }
  .field-select:focus, .field-input:focus { border-color: var(--sf-blue); }
  .field-select option { background: var(--bg); }

  .soql-output {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 16px;
    font-size: 12px;
    color: var(--sf-blue);
    letter-spacing: 0.05em;
    min-height: 48px;
    transition: all 0.3s;
    word-break: break-all;
  }

  .gen-btn {
    margin-top: 16px;
    background: var(--sf-blue);
    color: var(--bg);
    border: none;
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 11px 24px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .gen-btn:hover { background: #30B8F0; transform: translateY(-1px); }

  /* TRIGGER FRAMEWORK */
  .copy-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--mono);
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.1em;
  }
  .copy-btn:hover { border-color: var(--sf-blue); color: var(--sf-blue); }
  .copy-btn.copied { border-color: #06D670; color: #06D670; }

  /* STATUS INDICATOR */
  .status-strip {
    display: flex;
    gap: 24px;
    padding: 12px 20px;
    background: rgba(0,161,224,0.05);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 28px;
  }
  .status-item { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--muted); }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: #06D670; box-shadow: 0 0 6px #06D670; animation: blink 2s ease-in-out infinite; }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* INTEGRATION DIAGRAM */
  .int-diagram {
    display: flex;
    align-items: center;
    gap: 0;
    padding: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 20px;
    overflow-x: auto;
    flex-wrap: nowrap;
  }
  .int-node {
    flex-shrink: 0;
    min-width: 110px;
    padding: 14px 16px;
    border-radius: 6px;
    text-align: center;
    font-size: 11px;
    font-family: var(--display);
    font-weight: 700;
    letter-spacing: 0.06em;
    border: 1px solid;
  }
  .int-node.sf { background: rgba(0,161,224,0.12); border-color: var(--sf-blue); color: var(--sf-blue); }
  .int-node.mule { background: rgba(0,178,124,0.12); border-color: #00B27C; color: #00B27C; }
  .int-node.ext { background: rgba(255,183,93,0.12); border-color: var(--sf-lightning); color: var(--sf-lightning); }
  .int-node.heroku { background: rgba(123,94,167,0.12); border-color: #7B5EA7; color: #B89DDF; }
  .int-node.kafka { background: rgba(194,57,52,0.12); border-color: var(--sf-red); color: #FF8A8A; }
  .int-node-label { font-size: 9px; font-weight: 400; color: var(--muted); margin-top: 4px; font-family: var(--mono); letter-spacing: 0.1em; }
  .int-arrow {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 4px;
    gap: 3px;
    min-width: 60px;
  }
  .int-arrow-line {
    height: 2px;
    width: 100%;
    background: linear-gradient(90deg, var(--border), rgba(0,161,224,0.4), var(--border));
    position: relative;
  }
  .int-arrow-line::after { content: '▶'; position: absolute; right: -5px; top: -7px; font-size: 9px; color: var(--muted); }
  .int-arrow-label { font-size: 9px; color: var(--muted); letter-spacing: 0.06em; text-align: center; white-space: nowrap; }
  .int-arrow.bi .int-arrow-line::before { content: '◀'; position: absolute; left: -5px; top: -7px; font-size: 9px; color: var(--muted); }

  /* TAB PILLS */
  .tab-pills { display: flex; gap: 4px; margin-bottom: 24px; border-bottom: 1px solid var(--border); padding-bottom: 0; }
  .tab-pill {
    padding: 8px 18px;
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.15s;
    font-family: var(--display);
    font-weight: 700;
  }
  .tab-pill:hover { color: var(--text); }
  .tab-pill.active { color: var(--sf-blue); border-bottom-color: var(--sf-blue); }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.25s ease; }

  /* FLOW DEBUG STEPS */
  .flow-steps { display: grid; gap: 12px; margin-bottom: 24px; }
  .flow-step {
    display: grid;
    grid-template-columns: 40px 1fr;
    gap: 16px;
    align-items: start;
    padding: 14px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    transition: border-color 0.2s;
  }
  .flow-step:hover { border-color: rgba(0,161,224,0.35); }
  .flow-step-num {
    width: 36px; height: 36px;
    border: 1px solid var(--sf-blue);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--display);
    font-weight: 900;
    font-size: 13px;
    color: var(--sf-blue);
    flex-shrink: 0;
  }
  .flow-step-title { font-family: var(--display); font-weight: 700; font-size: 12px; color: var(--text); margin-bottom: 4px; }
  .flow-step-desc { font-size: 11px; color: var(--muted); line-height: 1.65; }
  .flow-step-tip { margin-top: 8px; padding: 8px 12px; background: rgba(255,183,93,0.08); border-left: 2px solid var(--sf-lightning); font-size: 10px; color: var(--sf-lightning); line-height: 1.6; }

  /* METADATA GRID */
  .meta-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; margin-bottom: 24px; }
  .meta-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 16px;
    transition: border-color 0.2s, transform 0.15s;
  }
  .meta-card:hover { border-color: rgba(0,161,224,0.4); transform: translateY(-2px); }
  .meta-type { font-family: var(--display); font-weight: 700; font-size: 11px; color: var(--sf-blue); margin-bottom: 4px; letter-spacing: 0.05em; }
  .meta-file { font-size: 10px; color: var(--sf-lightning); font-style: italic; margin-bottom: 6px; }
  .meta-desc { font-size: 11px; color: var(--muted); line-height: 1.6; }

  /* DECISION MATRIX */
  .decision-scenario {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 24px;
  }
  .scenario-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .scenario-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
    background: rgba(0,161,224,0.15);
    border: 1px solid var(--sf-blue);
  }
  .scenario-desc {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.65;
    margin-bottom: 16px;
  }

  .decision-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
  }
  .decision-option {
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 6px;
    padding: 16px;
    transition: all 0.2s;
    position: relative;
  }
  .decision-option:hover {
    border-color: rgba(0,161,224,0.4);
    transform: translateY(-2px);
  }
  .decision-option.winner {
    border-color: var(--sf-blue);
    background: rgba(0,161,224,0.06);
  }
  .decision-option.avoid {
    border-color: rgba(194,57,52,0.4);
    opacity: 0.6;
  }
  .option-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .option-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.05em;
  }
  .option-name.flow { color: #FFB75D; }
  .option-name.apex { color: var(--sf-blue); }
  .option-name.mule { color: #00B27C; }
  .verdict-badge {
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 0.15em;
    padding: 3px 8px;
    border-radius: 2px;
    text-transform: uppercase;
    font-family: var(--display);
  }
  .verdict-badge.best {
    background: rgba(0,161,224,0.2);
    color: var(--sf-blue);
    border: 1px solid var(--sf-blue);
  }
  .verdict-badge.ok {
    background: rgba(255,183,93,0.15);
    color: var(--sf-lightning);
    border: 1px solid rgba(255,183,93,0.4);
  }
  .verdict-badge.avoid {
    background: rgba(194,57,52,0.15);
    color: #FF6B6B;
    border: 1px solid rgba(194,57,52,0.4);
  }
  .option-reasons {
    list-style: none;
    display: grid;
    gap: 6px;
  }
  .reason {
    font-size: 10px;
    line-height: 1.5;
    color: var(--muted);
    display: flex;
    align-items: flex-start;
    gap: 8px;
  }
  .reason-icon {
    flex-shrink: 0;
    margin-top: 1px;
    font-size: 10px;
  }
  .reason-icon.pro { color: #06D670; }
  .reason-icon.con { color: #FF6B6B; }

  /* COMPARISON TABLE */
  .compare-table {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 24px;
  }
  .compare-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 1px;
    background: var(--border);
  }
  .compare-header-cell {
    background: var(--surface2);
    padding: 12px 16px;
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    text-align: center;
  }
  .compare-header-cell:first-child { text-align: left; }
  .compare-header-cell.flow { color: #FFB75D; }
  .compare-header-cell.apex { color: var(--sf-blue); }
  .compare-header-cell.mule { color: #00B27C; }
  .compare-body {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 1px;
    background: var(--border);
  }
  .compare-row {
    display: contents;
  }
  .compare-cell {
    background: var(--surface);
    padding: 14px 16px;
    font-size: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.5;
  }
  .compare-cell:first-child {
    justify-content: flex-start;
    color: var(--text);
    font-weight: 600;
  }
  .compare-cell.rating-high { color: #06D670; }
  .compare-cell.rating-med { color: var(--sf-lightning); }
  .compare-cell.rating-low { color: #FF6B6B; }

  /* APEX BUILDER */
  .template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  .template-card {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 6px;
    padding: 18px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }
  .template-card:hover {
    border-color: var(--sf-blue);
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,161,224,0.15);
  }
  .template-card.selected {
    border-color: var(--sf-blue);
    background: rgba(0,161,224,0.08);
  }
  .template-icon {
    font-size: 28px;
    margin-bottom: 10px;
  }
  .template-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 13px;
    color: var(--text);
    margin-bottom: 6px;
  }
  .template-desc {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.6;
  }
  .template-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 8px;
    padding: 3px 8px;
    border-radius: 2px;
    background: rgba(0,161,224,0.15);
    color: var(--sf-blue);
    font-weight: 700;
    letter-spacing: 0.1em;
  }

  .config-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .config-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--sf-blue);
    margin-bottom: 16px;
  }
  .config-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 12px;
  }
  .config-row.full {
    grid-template-columns: 1fr;
  }

  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 8px;
  }
  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .checkbox-item input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    accent-color: var(--sf-blue);
  }
  .checkbox-item label {
    font-size: 11px;
    color: var(--text);
    cursor: pointer;
  }

  .method-list {
    display: grid;
    gap: 10px;
    margin-bottom: 16px;
  }
  .method-item {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items: center;
  }
  .method-sig {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--sf-blue);
  }
  .method-remove {
    background: transparent;
    border: 1px solid rgba(194,57,52,0.4);
    color: #FF6B6B;
    font-size: 9px;
    padding: 4px 10px;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: var(--display);
    font-weight: 700;
    letter-spacing: 0.1em;
  }
  .method-remove:hover {
    background: rgba(194,57,52,0.15);
    border-color: #FF6B6B;
  }

  .add-method-btn {
    background: transparent;
    border: 1px dashed var(--border);
    color: var(--muted);
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
  }
  .add-method-btn:hover {
    border-color: var(--sf-blue);
    color: var(--sf-blue);
    border-style: solid;
  }

  .generate-btn {
    background: var(--sf-blue);
    color: var(--bg);
    border: none;
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 14px 32px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    margin-top: 8px;
  }
  .generate-btn:hover {
    background: #30B8F0;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,161,224,0.3);
  }

  /* MULESOFT HANDBOOK */
  .edge-case-card {
    background: var(--surface);
    border-left: 4px solid var(--sf-lightning);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 24px;
  }
  .edge-case-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 16px;
  }
  .edge-case-icon {
    width: 44px;
    height: 44px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
    background: rgba(255,183,93,0.15);
    border: 1px solid var(--sf-lightning);
  }
  .edge-case-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    margin-bottom: 6px;
  }
  .edge-case-scenario {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }
  .solution-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0;
  }
  .solution-tab {
    padding: 8px 16px;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-family: var(--display);
    font-weight: 700;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.15s;
  }
  .solution-tab:hover { color: var(--text); }
  .solution-tab.active { color: var(--sf-blue); border-bottom-color: var(--sf-blue); }
  .solution-content { display: none; padding: 16px 0; }
  .solution-content.active { display: block; }
  .solution-content h4 {
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    color: var(--sf-blue);
    margin-bottom: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .solution-content p {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 12px;
  }
  .solution-content ul {
    list-style: none;
    display: grid;
    gap: 6px;
    margin: 12px 0;
  }
  .solution-content li {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }
  .solution-content li::before {
    content: '→';
    color: var(--sf-blue);
    flex-shrink: 0;
    margin-top: 2px;
  }

  .best-practice-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .bp-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }
  .bp-icon {
    font-size: 24px;
  }
  .bp-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 13px;
    color: var(--text);
  }
  .bp-list {
    display: grid;
    gap: 12px;
  }
  .bp-item {
    display: grid;
    grid-template-columns: 24px 1fr;
    gap: 12px;
    align-items: start;
  }
  .bp-check {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    background: rgba(6,214,112,0.15);
    color: #06D670;
    border: 1px solid #06D670;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .bp-text {
    font-size: 11px;
    color: var(--text);
    line-height: 1.6;
  }
  .bp-detail {
    font-size: 10px;
    color: var(--muted);
    margin-top: 4px;
    line-height: 1.5;
  }

  .warning-box {
    background: rgba(194,57,52,0.08);
    border-left: 3px solid var(--sf-red);
    border-radius: 3px;
    padding: 14px 16px;
    margin: 16px 0;
  }
  .warning-box-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    color: #FF6B6B;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .warning-box-text {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }

  .info-box {
    background: rgba(0,161,224,0.06);
    border-left: 3px solid var(--sf-blue);
    border-radius: 3px;
    padding: 14px 16px;
    margin: 16px 0;
  }
  .info-box-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    color: var(--sf-blue);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .info-box-text {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }

  /* LWC LIFECYCLE GRID */
  .lifecycle-grid {
    display: grid;
    gap: 16px;
    margin-bottom: 24px;
  }
  .lifecycle-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 18px;
    transition: border-color 0.2s;
  }
  .lifecycle-card:hover { border-color: rgba(0,161,224,0.4); }
  .lifecycle-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    color: var(--sf-blue);
    margin-bottom: 8px;
  }
  .lifecycle-when {
    font-size: 10px;
    color: var(--sf-lightning);
    margin-bottom: 10px;
    font-style: italic;
  }
  .lifecycle-desc {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 12px;
  }
  .lifecycle-use {
    font-size: 10px;
    color: var(--text);
    background: rgba(0,161,224,0.06);
    padding: 8px 12px;
    border-radius: 3px;
    border-left: 2px solid var(--sf-blue);
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  @media (max-width: 768px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar { position: static; height: auto; display: flex; flex-wrap: wrap; padding: 12px; gap: 4px; }
    .nav-item { padding: 8px 12px; border-left: none; border-bottom: 2px solid transparent; }
    .nav-item.active { border-left: none; border-bottom-color: var(--sf-blue); }
    .content { padding: 24px 20px; }
    .soql-row { grid-template-columns: 1fr; }
    .limit-row { grid-template-columns: 1fr auto; }
    .limit-bar-wrap { display: none; }
  }
</style>
</head>
<body>

<header class="header">
  <div class="logo-ring">⚡</div>
  <div>
    <div class="header-title">SF DEV TOOLKIT</div>
    <div class="header-sub">Apex · SOQL · LWC · Patterns</div>
  </div>
  <div class="version-badge">API v62.0</div>
</header>

<div class="layout">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-section">Core</div>
    <div class="nav-item active" onclick="showPanel('governor')">
      <span class="nav-dot"></span>Governor Limits
    </div>
    <div class="nav-item" onclick="showPanel('apex')">
      <span class="nav-dot"></span>Apex Patterns
    </div>
    <div class="nav-item" onclick="showPanel('soql')">
      <span class="nav-dot"></span>SOQL Builder
    </div>
    <div class="nav-item" onclick="showPanel('apex-builder')">
      <span class="nav-dot"></span>Apex Builder
    </div>

    <div class="sidebar-section">Architecture</div>
    <div class="nav-item" onclick="showPanel('decision')">
      <span class="nav-dot"></span>Decision Matrix
    </div>
    <div class="nav-item" onclick="showPanel('trigger')">
      <span class="nav-dot"></span>Trigger Framework
    </div>
    <div class="nav-item" onclick="showPanel('lwc')">
      <span class="nav-dot"></span>LWC Patterns
    </div>

    <div class="sidebar-section">Integrations</div>
    <div class="nav-item" onclick="showPanel('metadata')">
      <span class="nav-dot"></span>Metadata API
    </div>
    <div class="nav-item" onclick="showPanel('flow')">
      <span class="nav-dot"></span>Flow Debugging
    </div>
    <div class="nav-item" onclick="showPanel('integrations')">
      <span class="nav-dot"></span>Integration Patterns
    </div>
    <div class="nav-item" onclick="showPanel('mule-handbook')">
      <span class="nav-dot"></span>MuleSoft Handbook
    </div>

    <div class="sidebar-section">Quality</div>
    <div class="nav-item" onclick="showPanel('review')">
      <span class="nav-dot"></span>Code Review
    </div>
    <div class="nav-item" onclick="showPanel('test')">
      <span class="nav-dot"></span>Test Patterns
    </div>
  </nav>

  <!-- CONTENT -->
  <main class="content">

    <!-- GOVERNOR LIMITS -->
    <section class="panel active" id="governor">
      <div class="panel-header">
        <div class="panel-eyebrow">Salesforce Platform</div>
        <div class="panel-title">Governor Limits Reference</div>
        <div class="panel-desc">Per-transaction execution limits enforced by the Salesforce runtime. Exceeding these throws a <code>LimitException</code>. Design all Apex with bulkification in mind.</div>
      </div>

      <div class="status-strip">
        <div class="status-item"><div class="status-dot"></div>Sync Transaction</div>
        <div class="status-item" style="color:var(--sf-lightning)">⚡ Async limits are generally 2× higher</div>
      </div>

      <div class="limits-grid">
        <!-- DML -->
        <div style="font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);padding:4px 0 2px;">DML Operations</div>
        <div class="limit-row">
          <div>
            <div class="limit-name">DML Statements</div>
            <div class="limit-desc">insert, update, delete, upsert, merge, undelete per transaction</div>
          </div>
          <div class="limit-val" style="color:var(--sf-blue)">150</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:30%;background:var(--sf-blue)"></div></div>
        </div>
        <div class="limit-row">
          <div>
            <div class="limit-name">DML Rows</div>
            <div class="limit-desc">Total records across all DML operations</div>
          </div>
          <div class="limit-val" style="color:var(--sf-blue)">10,000</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:60%;background:var(--sf-blue)"></div></div>
        </div>

        <!-- SOQL -->
        <div style="font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);padding:12px 0 2px;">SOQL Queries</div>
        <div class="limit-row">
          <div>
            <div class="limit-name">SOQL Queries</div>
            <div class="limit-desc">SELECT statements issued per transaction (sync)</div>
          </div>
          <div class="limit-val" style="color:#06D670">100</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:25%;background:#06D670"></div></div>
        </div>
        <div class="limit-row">
          <div>
            <div class="limit-name">SOQL Rows Returned</div>
            <div class="limit-desc">Total records returned across all queries</div>
          </div>
          <div class="limit-val" style="color:#06D670">50,000</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:70%;background:#06D670"></div></div>
        </div>
        <div class="limit-row">
          <div>
            <div class="limit-name">SOQL Rows via Database.getQueryLocator</div>
            <div class="limit-desc">Used in Batch Apex start() method</div>
          </div>
          <div class="limit-val" style="color:#06D670">50M</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:100%;background:#06D670"></div></div>
        </div>

        <!-- CPU / HEAP -->
        <div style="font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);padding:12px 0 2px;">CPU & Memory</div>
        <div class="limit-row">
          <div>
            <div class="limit-name">CPU Time</div>
            <div class="limit-desc">Synchronous execution (10s async)</div>
          </div>
          <div class="limit-val" style="color:var(--sf-lightning)">10s</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:50%;background:var(--sf-lightning)"></div></div>
        </div>
        <div class="limit-row">
          <div>
            <div class="limit-name">Heap Size</div>
            <div class="limit-desc">Sync (12MB async). Avoid storing full sObject lists in memory.</div>
          </div>
          <div class="limit-val" style="color:var(--sf-lightning)">6MB</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:40%;background:var(--sf-lightning)"></div></div>
        </div>

        <!-- CALLOUTS -->
        <div style="font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--muted);padding:12px 0 2px;">Callouts</div>
        <div class="limit-row">
          <div>
            <div class="limit-name">HTTP Callouts</div>
            <div class="limit-desc">Cannot mix callouts and DML without @future(callout=true)</div>
          </div>
          <div class="limit-val" style="color:#B89DDF">100</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:25%;background:#B89DDF"></div></div>
        </div>
        <div class="limit-row">
          <div>
            <div class="limit-name">Callout Timeout</div>
            <div class="limit-desc">Per single HTTP request (configurable up to max)</div>
          </div>
          <div class="limit-val" style="color:#B89DDF">120s</div>
          <div class="limit-bar-wrap"><div class="limit-bar" style="width:35%;background:#B89DDF"></div></div>
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Runtime Limit Checking</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="cmt">// Always check limits before costly operations in loops</span>
<span class="kw">if</span> (Limits.getDmlStatements() &lt; Limits.getLimitDmlStatements() - <span class="num">10</span>) {
    <span class="cmt">// Safe to DML — 10 statement buffer</span>
    <span class="met">insert</span> recordsToInsert;
}

<span class="cmt">// Log current consumption (useful in debug / monitoring)</span>
System.<span class="met">debug</span>(<span class="str">'SOQL used: '</span> + Limits.<span class="met">getQueries</span>() +
    <span class="str">' / '</span> + Limits.<span class="met">getLimitQueries</span>());
System.<span class="met">debug</span>(<span class="str">'DML rows: '</span> + Limits.<span class="met">getDmlRows</span>() +
    <span class="str">' / '</span> + Limits.<span class="met">getLimitDmlRows</span>());</pre>
      </div>
    </section>

    <!-- DECISION MATRIX -->
    <section class="panel" id="decision">
      <div class="panel-header">
        <div class="panel-eyebrow">Architecture Decisions</div>
        <div class="panel-title">Flow vs. Apex vs. MuleSoft — Decision Matrix</div>
        <div class="panel-desc">A practical guide for admins and architects to choose the right tool for automation. This decision tree covers common use cases with clear recommendations based on complexity, maintainability, and scalability.</div>
      </div>

      <!-- HIGH-LEVEL COMPARISON TABLE -->
      <div class="compare-table">
        <div class="compare-header">
          <div class="compare-header-cell">Criteria</div>
          <div class="compare-header-cell flow">Flow</div>
          <div class="compare-header-cell apex">Apex</div>
          <div class="compare-header-cell mule">MuleSoft</div>
        </div>
        <div class="compare-body">
          <div class="compare-row">
            <div class="compare-cell">Ease of Development</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>No-code / Low-code</div>
            <div class="compare-cell rating-med">⭐⭐<br>Requires dev skills</div>
            <div class="compare-cell rating-med">⭐⭐<br>Integration specialist</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Maintainability</div>
            <div class="compare-cell rating-med">⭐⭐<br>Can get complex</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Version control + tests</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Reusable components</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Performance</div>
            <div class="compare-cell rating-med">⭐⭐<br>Good for simple logic</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Optimized code</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Async + batching</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Governor Limit Handling</div>
            <div class="compare-cell rating-low">⭐<br>Limited control</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Full control</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Bulk API 2.0</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Cross-System Integration</div>
            <div class="compare-cell rating-low">⭐<br>Limited HTTP callouts</div>
            <div class="compare-cell rating-med">⭐⭐<br>Callouts + Platform Events</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Built for integration</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Debugging & Troubleshooting</div>
            <div class="compare-cell rating-med">⭐⭐<br>Flow debug mode</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Full debug logs + tests</div>
            <div class="compare-cell rating-med">⭐⭐<br>Anypoint monitoring</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Complex Transformations</div>
            <div class="compare-cell rating-low">⭐<br>Formula limitations</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Full language power</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>DataWeave</div>
          </div>
          <div class="compare-row">
            <div class="compare-cell">Cost</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Included in license</div>
            <div class="compare-cell rating-high">⭐⭐⭐<br>Included in license</div>
            <div class="compare-cell rating-low">⭐<br>Separate license</div>
          </div>
        </div>
      </div>

      <!-- SCENARIO 1: FIELD UPDATE AFTER INSERT -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">1️⃣</div>
          <div>Update a field on the same record after insert (e.g., set Status based on Amount)</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> When an Opportunity is created, you need to automatically set the Status__c field to "High Priority" if Amount > $100,000, otherwise "Standard". This is simple field-level logic with no external systems involved.
        </div>
        <div class="decision-grid">
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Before-save flow runs before record commits — no extra DML</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Simple point-and-click decision logic</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Admin-friendly, no code deployment</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Built-in bulkification</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge ok">~ Overkill</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Works perfectly in before trigger</li>
              <li class="reason"><span class="reason-icon con">✗</span>Requires developer + deployment</li>
              <li class="reason"><span class="reason-icon con">✗</span>Over-engineered for simple logic</li>
              <li class="reason"><span class="reason-icon con">✗</span>Test class overhead</li>
            </ul>
          </div>
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>Data must leave Salesforce for enrichment</li>
              <li class="reason"><span class="reason-icon con">✗</span>Extra round-trip latency (async)</li>
              <li class="reason"><span class="reason-icon con">✗</span>Adds infrastructure complexity</li>
              <li class="reason"><span class="reason-icon con">✗</span>No benefit for internal-only logic</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SCENARIO 2: CROSS-OBJECT FIELD UPDATES -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">2️⃣</div>
          <div>Update parent Account when child Opportunity is closed (rollup summary alternative)</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> When an Opportunity stage changes to "Closed Won", update the parent Account's "Last Win Date" and increment "Total Wins" counter. This is a simple parent-child update pattern.
        </div>
        <div class="decision-grid">
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>After-save flow can update related records</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Visual logic easy to understand</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Handles bulk correctly with Get/Update Records</li>
              <li class="reason"><span class="reason-icon con">✗</span>Careful: don't query in loops</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge ok">~ OK</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>After-trigger handles this cleanly</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Better if complex aggregation logic</li>
              <li class="reason"><span class="reason-icon con">✗</span>Requires code for simple updates</li>
              <li class="reason"><span class="reason-icon con">✗</span>Flow is sufficient for this case</li>
            </ul>
          </div>
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>Unnecessary external orchestration</li>
              <li class="reason"><span class="reason-icon con">✗</span>Salesforce handles this natively</li>
              <li class="reason"><span class="reason-icon con">✗</span>Async delay not acceptable here</li>
              <li class="reason"><span class="reason-icon con">✗</span>No cross-system need</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SCENARIO 3: COMPLEX BUSINESS LOGIC -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">3️⃣</div>
          <div>Complex validation with external credit check API before record creation</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> Before creating an Account, call a third-party credit scoring API. If credit score < 600, prevent creation with error message. If 600-700, set to "Review Required". If > 700, auto-approve and create related Contract record. This involves external callouts, conditional logic, and multi-object DML.
        </div>
        <div class="decision-grid">
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>Cannot do callouts in before-save flows</li>
              <li class="reason"><span class="reason-icon con">✗</span>Screen flow forces manual intervention</li>
              <li class="reason"><span class="reason-icon con">✗</span>Error handling limited in flows</li>
              <li class="reason"><span class="reason-icon con">✗</span>Complex branching becomes unmaintainable</li>
            </ul>
          </div>
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Full control over HTTP callout + retry logic</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Can use @future for async callout</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Rich error handling with try-catch</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Easily testable with mock callouts</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge ok">~ OK</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>If API enrichment before SF insert is standard pattern</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Mule can validate, enrich, then upsert to SF</li>
              <li class="reason"><span class="reason-icon con">✗</span>Adds latency — not real-time validation</li>
              <li class="reason"><span class="reason-icon con">✗</span>Requires data to route through Mule first</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SCENARIO 4: HIGH-VOLUME DATA SYNC -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">4️⃣</div>
          <div>Sync 50,000+ records daily from ERP system to Salesforce (Orders, Products, Inventory)</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> Every night, a batch job pulls Orders, Products, and Inventory levels from SAP/NetSuite/Oracle ERP and needs to upsert them into Salesforce. Data transformation includes mapping ERP codes to Salesforce External IDs, currency conversion, and splitting single ERP records into multiple SF objects (Order + Line Items).
        </div>
        <div class="decision-grid">
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>Flows cannot accept external data directly</li>
              <li class="reason"><span class="reason-icon con">✗</span>No batch processing for 50k+ records</li>
              <li class="reason"><span class="reason-icon con">✗</span>Governor limits hit quickly at scale</li>
              <li class="reason"><span class="reason-icon con">✗</span>Not designed for ETL workloads</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge ok">~ OK</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Batch Apex can handle large volumes</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Invocable from external systems via REST API</li>
              <li class="reason"><span class="reason-icon con">✗</span>Transformation logic in Apex = tight coupling</li>
              <li class="reason"><span class="reason-icon con">✗</span>Batch Apex: 5 jobs queued max, slower</li>
            </ul>
          </div>
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Bulk API 2.0 auto-chunks into 10k batches</li>
              <li class="reason"><span class="reason-icon pro">✓</span>DataWeave for complex transformations</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Error handling: failed records → retry queue</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Decouples ERP from SF (no tight dependency)</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SCENARIO 5: REAL-TIME CROSS-SYSTEM ORCHESTRATION -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">5️⃣</div>
          <div>When Order is placed in Salesforce, create shipment in warehouse system AND send confirmation email</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> User clicks "Submit Order" button on a Lightning page. This needs to: (1) Create Order record in SF, (2) Call warehouse API to reserve inventory and create shipment, (3) Call email service to send confirmation, (4) Update Order with tracking number from warehouse response. All must happen in real-time.
        </div>
        <div class="decision-grid">
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>HTTP callouts in flows are limited</li>
              <li class="reason"><span class="reason-icon con">✗</span>Cannot chain multiple callouts reliably</li>
              <li class="reason"><span class="reason-icon con">✗</span>Poor error recovery (retry, rollback)</li>
              <li class="reason"><span class="reason-icon con">✗</span>Mixing DML + callouts causes issues</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge ok">~ OK</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>@future(callout=true) for async callouts</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Platform Events for decoupled orchestration</li>
              <li class="reason"><span class="reason-icon con">✗</span>Complex to coordinate multi-step workflows</li>
              <li class="reason"><span class="reason-icon con">✗</span>All logic tightly coupled in SF</li>
            </ul>
          </div>
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Built for orchestration workflows</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Saga pattern: rollback on any step failure</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Retry policies + circuit breakers</li>
              <li class="reason"><span class="reason-icon pro">✓</span>SF publishes event → Mule orchestrates</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- SCENARIO 6: FIELD ENRICHMENT BEFORE INSERT -->
      <div class="decision-scenario">
        <div class="scenario-title">
          <div class="scenario-icon">6️⃣</div>
          <div>Enrich Contact with company data from Clearbit/ZoomInfo before inserting into Salesforce</div>
        </div>
        <div class="scenario-desc">
          <strong>Context:</strong> Sales team imports leads from a CSV or web form. Before creating Contact records, you want to call Clearbit API to enrich with company name, industry, employee count, and LinkedIn URL. If enrichment fails, still create the Contact with partial data.
        </div>
        <div class="decision-grid">
          <div class="decision-option avoid">
            <div class="option-header">
              <div class="option-name flow">FLOW</div>
              <div class="verdict-badge avoid">✗ Avoid</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon con">✗</span>Before-save flows cannot do callouts</li>
              <li class="reason"><span class="reason-icon con">✗</span>After-save requires extra update DML</li>
              <li class="reason"><span class="reason-icon con">✗</span>Poor handling of API failures</li>
              <li class="reason"><span class="reason-icon con">✗</span>User waits for async enrichment</li>
            </ul>
          </div>
          <div class="decision-option">
            <div class="option-header">
              <div class="option-name apex">APEX</div>
              <div class="verdict-badge ok">~ OK</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Platform Event → async enrichment in trigger</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Queueable Apex for chained callouts</li>
              <li class="reason"><span class="reason-icon con">✗</span>Still requires record insert before enrichment</li>
              <li class="reason"><span class="reason-icon con">✗</span>Not ideal for pre-insert enrichment</li>
            </ul>
          </div>
          <div class="decision-option winner">
            <div class="option-header">
              <div class="option-name mule">MULESOFT</div>
              <div class="verdict-badge best">✓ Best</div>
            </div>
            <ul class="option-reasons">
              <li class="reason"><span class="reason-icon pro">✓</span>Data routes through Mule BEFORE SF insert</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Enrich → Transform → Upsert in one flow</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Graceful degradation on API failure</li>
              <li class="reason"><span class="reason-icon pro">✓</span>Records arrive in SF fully enriched</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- DECISION TREE SUMMARY -->
      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Quick Decision Tree — When to Use What</span>
          <span class="code-tag tag-info">Reference</span>
        </div>
        <pre><span class="cmt">┌─────────────────────────────────────────────────────────────────┐
│ START: What are you trying to automate?                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
          Does it involve               │
          external systems?              │
                    │                    │
            ┌───────┴───────┐            │
          YES               NO           │
            │                │           │
            ▼                ▼           │
    ┌───────────────┐  ┌────────────────┤
    │ EXTERNAL?     │  │ INTERNAL-ONLY? │
    └───────────────┘  └────────────────┘
            │                │
            │                ├── Simple field update (same object)?
            │                │   → <span class="str">FLOW (before-save)</span>
            │                │
            │                ├── Cross-object update (parent/child)?
            │                │   → <span class="str">FLOW (after-save)</span> OR <span class="str">APEX</span> if complex
            │                │
            │                ├── Complex calculations / validation?
            │                │   → <span class="str">APEX</span>
            │                │
            │                ├── Bulk processing (>10k records)?
            │                    → <span class="str">APEX Batch</span>
            │
            ├── Single API call (enrich/validate)?
            │   │
            │   ├── Real-time user action?
            │   │   → <span class="str">APEX (with @future or Platform Event)</span>
            │   │
            │   └── Async batch enrichment?
            │       → <span class="str">MULESOFT</span> (if data comes from outside)
            │       → <span class="str">APEX Batch</span> (if data already in SF)
            │
            ├── Multi-step orchestration (warehouse + email + payment)?
            │   → <span class="str">MULESOFT</span> (built for workflows)
            │
            ├── High-volume ETL (ERP → Salesforce)?
            │   → <span class="str">MULESOFT</span> with Bulk API 2.0
            │
            └── Pre-insert enrichment (data arrives enriched)?
                → <span class="str">MULESOFT</span> (enrich before upsert)

<span class="cmt">╔══════════════════════════════════════════════════════════════╗
║ GENERAL RULES OF THUMB                                      ║
╠══════════════════════════════════════════════════════════════╣
║ • Start with FLOW when possible (admin-friendly, fast)      ║
║ • Escalate to APEX when:                                    ║
║   - Complex logic, loops, or external callouts needed       ║
║   - Governor limit control required                         ║
║   - Version control + automated testing critical            ║
║ • Escalate to MULESOFT when:                                ║
║   - Multiple systems involved in one workflow               ║
║   - High-volume data sync (>10k records)                    ║
║   - Pre-insert enrichment from external APIs                ║
║   - Reusable integration assets across projects             ║
╚══════════════════════════════════════════════════════════════╝</span></pre>
      </div>

    </section>

    <!-- APEX PATTERNS -->
    <section class="panel" id="apex">
      <div class="panel-header">
        <div class="panel-eyebrow">Best Practices</div>
        <div class="panel-title">Apex Design Patterns</div>
        <div class="panel-desc">Production-grade patterns for bulkification, error handling, and scalable architecture.</div>
      </div>

      <div class="pattern-grid">

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">✅ Bulkified Service Class</span>
            <div style="display:flex;gap:8px">
              <span class="code-tag tag-good">GOOD</span>
              <span class="code-tag tag-apex">Apex</span>
            </div>
          </div>
          <pre><span class="ann">public class</span> <span class="cls">AccountService</span> {

    <span class="cmt">// One SOQL for the entire batch — never query inside a loop</span>
    <span class="kw">public static void</span> <span class="met">enrichAccounts</span>(List&lt;<span class="cls">Account</span>&gt; accounts) {
        Set&lt;<span class="cls">Id</span>&gt; accountIds = <span class="kw">new</span> <span class="cls">Set</span>&lt;<span class="cls">Id</span>&gt;();
        <span class="kw">for</span> (<span class="cls">Account</span> acc : accounts) {
            accountIds.<span class="met">add</span>(acc.Id);
        }

        <span class="cmt">// Aggregate child data in one query</span>
        Map&lt;<span class="cls">Id</span>, <span class="cls">AggregateResult</span>[]&gt; oppMap = <span class="kw">new</span> Map&lt;<span class="cls">Id</span>, <span class="cls">AggregateResult</span>[]&gt;();
        <span class="kw">for</span> (<span class="cls">AggregateResult</span> ar : [
            <span class="kw">SELECT</span> AccountId, <span class="kw">COUNT</span>(Id) cnt, <span class="kw">SUM</span>(Amount) total
            <span class="kw">FROM</span> <span class="cls">Opportunity</span>
            <span class="kw">WHERE</span> AccountId <span class="kw">IN</span> :accountIds
            <span class="kw">AND</span> StageName = <span class="str">'Closed Won'</span>
            <span class="kw">GROUP BY</span> AccountId
        ]) {
            <span class="cls">Id</span> accId = (<span class="cls">Id</span>) ar.<span class="met">get</span>(<span class="str">'AccountId'</span>);
            <span class="kw">if</span> (!oppMap.<span class="met">containsKey</span>(accId)) {
                oppMap.<span class="met">put</span>(accId, <span class="kw">new</span> <span class="cls">AggregateResult</span>[]{});
            }
            oppMap.<span class="met">get</span>(accId).<span class="met">add</span>(ar);
        }

        List&lt;<span class="cls">Account</span>&gt; toUpdate = <span class="kw">new</span> List&lt;<span class="cls">Account</span>&gt;();
        <span class="kw">for</span> (<span class="cls">Account</span> acc : accounts) {
            <span class="kw">if</span> (oppMap.<span class="met">containsKey</span>(acc.Id)) {
                <span class="cls">AggregateResult</span> ar = oppMap.<span class="met">get</span>(acc.Id)[<span class="num">0</span>];
                acc.NumberOfEmployees = (Integer) ar.<span class="met">get</span>(<span class="str">'cnt'</span>);
                toUpdate.<span class="met">add</span>(acc);
            }
        }

        <span class="cmt">// Database.update with allOrNone=false for partial success</span>
        List&lt;<span class="cls">Database.SaveResult</span>&gt; results =
            Database.<span class="met">update</span>(toUpdate, <span class="kw">false</span>);

        <span class="cls">ErrorHandler</span>.<span class="met">logSaveResults</span>(results, toUpdate);
    }
}</pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">❌ Anti-Pattern: SOQL In Loop</span>
            <div style="display:flex;gap:8px">
              <span class="code-tag tag-warn">AVOID</span>
              <span class="code-tag tag-apex">Apex</span>
            </div>
          </div>
          <pre><span class="cmt">// ❌ This hits governor limits at just 101 records!</span>
<span class="kw">for</span> (<span class="cls">Account</span> acc : accounts) {
    List&lt;<span class="cls">Contact</span>&gt; contacts = [
        <span class="kw">SELECT</span> Id, Name <span class="kw">FROM</span> Contact
        <span class="kw">WHERE</span> AccountId = :acc.Id   <span class="cmt">// SOQL inside a loop!</span>
    ];
    acc.Description = <span class="str">'Has '</span> + contacts.<span class="met">size</span>() + <span class="str">' contacts'</span>;
}

<span class="cmt">// ✅ Fix: query once, use a Map for O(1) lookups</span>
Map&lt;<span class="cls">Id</span>, List&lt;<span class="cls">Contact</span>&gt;&gt; contactsByAccount = <span class="kw">new</span> Map&lt;<span class="cls">Id</span>, List&lt;<span class="cls">Contact</span>&gt;&gt;();
<span class="kw">for</span> (<span class="cls">Contact</span> c : [
    <span class="kw">SELECT</span> Id, AccountId <span class="kw">FROM</span> Contact
    <span class="kw">WHERE</span> AccountId <span class="kw">IN</span> :accountIds
]) {
    <span class="kw">if</span> (!contactsByAccount.<span class="met">containsKey</span>(c.AccountId))
        contactsByAccount.<span class="met">put</span>(c.AccountId, <span class="kw">new</span> List&lt;<span class="cls">Contact</span>&gt;());
    contactsByAccount.<span class="met">get</span>(c.AccountId).<span class="met">add</span>(c);
}</pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Batch Apex — Chunked Processing</span>
            <div style="display:flex;gap:8px">
              <span class="code-tag tag-info">Pattern</span>
              <span class="code-tag tag-apex">Apex</span>
            </div>
          </div>
          <pre><span class="ann">global class</span> <span class="cls">AccountBatch</span> <span class="kw">implements</span> Database.<span class="cls">Batchable</span>&lt;<span class="cls">sObject</span>&gt;,
                                                    Database.<span class="cls">Stateful</span> {

    <span class="kw">global</span> Integer processedCount = <span class="num">0</span>;  <span class="cmt">// Stateful across chunks</span>

    <span class="kw">global</span> Database.<span class="cls">QueryLocator</span> <span class="met">start</span>(Database.<span class="cls">BatchableContext</span> bc) {
        <span class="kw">return</span> Database.<span class="met">getQueryLocator</span>([
            <span class="kw">SELECT</span> Id, Name, AnnualRevenue
            <span class="kw">FROM</span> Account
            <span class="kw">WHERE</span> AnnualRevenue &gt; <span class="num">0</span>
        ]);
    }

    <span class="kw">global void</span> <span class="met">execute</span>(Database.<span class="cls">BatchableContext</span> bc,
                          List&lt;<span class="cls">Account</span>&gt; scope) {
        <span class="cmt">// scope size = batchSize (default 200, max 2000)</span>
        List&lt;<span class="cls">Account</span>&gt; toUpdate = <span class="kw">new</span> List&lt;<span class="cls">Account</span>&gt;();
        <span class="kw">for</span> (<span class="cls">Account</span> acc : scope) {
            acc.Rating = acc.AnnualRevenue > <span class="num">1000000</span> ? <span class="str">'Hot'</span> : <span class="str">'Warm'</span>;
            toUpdate.<span class="met">add</span>(acc);
        }
        <span class="met">update</span> toUpdate;
        processedCount += scope.<span class="met">size</span>();
    }

    <span class="kw">global void</span> <span class="met">finish</span>(Database.<span class="cls">BatchableContext</span> bc) {
        System.<span class="met">debug</span>(<span class="str">'Processed: '</span> + processedCount + <span class="str">' records'</span>);
        <span class="cmt">// Chain another batch or send notification</span>
    }
}

<span class="cmt">// Execute: Database.executeBatch(new AccountBatch(), 200);</span></pre>
        </div>

      </div>
    </section>

    <!-- SOQL BUILDER -->
    <section class="panel" id="soql">
      <div class="panel-header">
        <div class="panel-eyebrow">Interactive Tool</div>
        <div class="panel-title">SOQL Query Builder</div>
        <div class="panel-desc">Compose SOQL queries with best practices built in.</div>
      </div>

      <div class="soql-builder">
        <div class="soql-row">
          <div class="field-group">
            <label class="field-label">Object</label>
            <select class="field-select" id="soql-obj">
              <option value="Account">Account</option>
              <option value="Contact">Contact</option>
              <option value="Opportunity">Opportunity</option>
              <option value="Case">Case</option>
              <option value="Lead">Lead</option>
              <option value="Task">Task</option>
              <option value="Custom_Object__c">Custom Object</option>
            </select>
          </div>
          <div class="field-group">
            <label class="field-label">Fields (comma separated)</label>
            <input class="field-input" id="soql-fields" value="Id, Name, CreatedDate" placeholder="Id, Name, ...">
          </div>
        </div>
        <div class="soql-row">
          <div class="field-group">
            <label class="field-label">WHERE Condition</label>
            <input class="field-input" id="soql-where" placeholder="IsActive = true AND ...">
          </div>
          <div class="field-group">
            <label class="field-label">ORDER BY</label>
            <input class="field-input" id="soql-order" placeholder="CreatedDate DESC">
          </div>
        </div>
        <div class="soql-row">
          <div class="field-group">
            <label class="field-label">LIMIT</label>
            <input class="field-input" id="soql-limit" type="number" value="200" min="1" max="50000">
          </div>
          <div class="field-group">
            <label class="field-label">Mode</label>
            <select class="field-select" id="soql-mode">
              <option value="list">List (Apex)</option>
              <option value="map">Map by Id (Apex)</option>
              <option value="raw">Raw SOQL only</option>
            </select>
          </div>
        </div>
        <button class="gen-btn" onclick="buildSOQL()">Generate Query →</button>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Generated Query</span>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="code-tag tag-soql">SOQL</span>
            <button class="copy-btn" id="copy-soql-btn" onclick="copySOQL()">COPY</button>
          </div>
        </div>
        <div class="soql-output" id="soql-output">
          Click "Generate Query →" to build your SOQL
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">SOQL Best Practices</span>
          <span class="code-tag tag-info">Reference</span>
        </div>
        <pre><span class="cmt">// 1. Always use bind variables (:var) — prevents SOQL injection</span>
String searchTerm = <span class="str">'Acme%'</span>;
List&lt;<span class="cls">Account</span>&gt; accs = [
    <span class="kw">SELECT</span> Id, Name <span class="kw">FROM</span> Account <span class="kw">WHERE</span> Name <span class="kw">LIKE</span> :searchTerm
];

<span class="cmt">// 2. Use selective filters — index on Id, Name, ExternalId, Email</span>
<span class="cmt">// 3. Never use SELECT * — list only needed fields</span>
<span class="cmt">// 4. For large data: use LIMIT + OFFSET pagination or QueryMore</span>
<span class="cmt">// 5. Avoid non-selective filters (IsDeleted, CreatedBy)</span>
<span class="cmt">// 6. Use relationship queries to reduce query count:</span>

List&lt;<span class="cls">Account</span>&gt; withContacts = [
    <span class="kw">SELECT</span> Id, Name,
        (<span class="kw">SELECT</span> Id, FirstName, LastName <span class="kw">FROM</span> Contacts
         <span class="kw">ORDER BY</span> LastName <span class="kw">LIMIT</span> <span class="num">5</span>)
    <span class="kw">FROM</span> Account
    <span class="kw">WHERE</span> Type = <span class="str">'Customer'</span>
    <span class="kw">LIMIT</span> <span class="num">200</span>
];</pre>
      </div>
    </section>

    <!-- APEX BUILDER -->
    <section class="panel" id="apex-builder">
      <div class="panel-header">
        <div class="panel-eyebrow">Code Generator</div>
        <div class="panel-title">Apex Class Builder</div>
        <div class="panel-desc">Generate production-ready Apex classes from templates. Configure class structure, methods, and best practices — then download or copy to your IDE.</div>
      </div>

      <!-- TEMPLATE SELECTION -->
      <div style="margin-bottom: 28px;">
        <div style="font-size:10px;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;font-weight:700;">Select Template</div>
        <div class="template-grid">
          <div class="template-card selected" onclick="selectTemplate('service', this)">
            <div class="template-icon">🔧</div>
            <div class="template-name">Service Class</div>
            <div class="template-desc">Business logic layer with bulkified methods for record processing. Invoked from triggers or controllers.</div>
            <div class="template-badge">COMMON</div>
          </div>
          <div class="template-card" onclick="selectTemplate('batch', this)">
            <div class="template-icon">📦</div>
            <div class="template-name">Batch Apex</div>
            <div class="template-desc">Process large datasets asynchronously. Implements Database.Batchable with start, execute, finish.</div>
            <div class="template-badge">ASYNC</div>
          </div>
          <div class="template-card" onclick="selectTemplate('rest', this)">
            <div class="template-icon">🌐</div>
            <div class="template-name">REST Endpoint</div>
            <div class="template-desc">@RestResource class with GET, POST, PATCH, DELETE methods for custom API.</div>
            <div class="template-badge">API</div>
          </div>
          <div class="template-card" onclick="selectTemplate('queueable', this)">
            <div class="template-icon">⚡</div>
            <div class="template-name">Queueable</div>
            <div class="template-desc">Async job with chaining support. Better than @future for complex workflows.</div>
            <div class="template-badge">ASYNC</div>
          </div>
          <div class="template-card" onclick="selectTemplate('controller', this)">
            <div class="template-icon">🎮</div>
            <div class="template-name">LWC Controller</div>
            <div class="template-desc">Backend Apex class with @AuraEnabled methods for Lightning Web Components.</div>
            <div class="template-badge">LWC</div>
          </div>
          <div class="template-card" onclick="selectTemplate('scheduler', this)">
            <div class="template-icon">⏰</div>
            <div class="template-name">Schedulable</div>
            <div class="template-desc">Scheduled Apex job with cron expression support. Runs on a schedule.</div>
            <div class="template-badge">ASYNC</div>
          </div>
        </div>
      </div>

      <!-- CONFIGURATION -->
      <div class="config-section">
        <div class="config-title">Class Configuration</div>
        <div class="config-row">
          <div class="field-group">
            <label class="field-label">Class Name</label>
            <input class="field-input" id="apex-class-name" value="AccountService" placeholder="e.g., AccountService">
          </div>
          <div class="field-group">
            <label class="field-label">Description</label>
            <input class="field-input" id="apex-class-desc" value="Handles Account business logic" placeholder="Brief description">
          </div>
        </div>
        <div class="config-row">
          <div class="field-group">
            <label class="field-label">Sharing Mode</label>
            <select class="field-select" id="apex-sharing">
              <option value="with sharing">with sharing (enforces user permissions)</option>
              <option value="without sharing">without sharing (system context)</option>
              <option value="inherited sharing">inherited sharing (defer to caller)</option>
            </select>
          </div>
          <div class="field-group">
            <label class="field-label">Access Modifier</label>
            <select class="field-select" id="apex-access">
              <option value="public">public</option>
              <option value="global">global (for managed packages / webservices)</option>
            </select>
          </div>
        </div>
        <div class="config-row full">
          <div class="field-group">
            <label class="field-label">Features</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="feat-error" checked>
                <label for="feat-error">Error Handling</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="feat-limits" checked>
                <label for="feat-limits">Governor Limit Checks</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="feat-logging">
                <label for="feat-logging">Debug Logging</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="feat-test">
                <label for="feat-test">Generate Test Class</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- METHOD BUILDER (for Service Class template) -->
      <div class="config-section" id="method-config" style="display:block;">
        <div class="config-title">Methods</div>
        <div class="method-list" id="method-list">
          <div class="method-item">
            <div class="method-sig">public static void enrichAccounts(List&lt;Account&gt; accounts)</div>
            <button class="method-remove" onclick="removeMethod(this)">REMOVE</button>
          </div>
        </div>
        <button class="add-method-btn" onclick="addMethod()">+ Add Method</button>
      </div>

      <!-- OBJECT SELECTION (for Batch template) -->
      <div class="config-section" id="batch-config" style="display:none;">
        <div class="config-title">Batch Configuration</div>
        <div class="config-row">
          <div class="field-group">
            <label class="field-label">Target Object</label>
            <select class="field-select" id="batch-object">
              <option value="Account">Account</option>
              <option value="Contact">Contact</option>
              <option value="Opportunity">Opportunity</option>
              <option value="Lead">Lead</option>
              <option value="Case">Case</option>
            </select>
          </div>
          <div class="field-group">
            <label class="field-label">Batch Size</label>
            <input class="field-input" type="number" id="batch-size" value="200" min="1" max="2000">
          </div>
        </div>
      </div>

      <!-- REST ENDPOINT CONFIG -->
      <div class="config-section" id="rest-config" style="display:none;">
        <div class="config-title">REST Endpoint Configuration</div>
        <div class="config-row full">
          <div class="field-group">
            <label class="field-label">URL Mapping</label>
            <input class="field-input" id="rest-url" value="/v1/accounts/*" placeholder="/v1/resource/*">
          </div>
        </div>
        <div class="config-row full">
          <div class="field-group">
            <label class="field-label">HTTP Methods</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="http-get" checked>
                <label for="http-get">GET</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="http-post" checked>
                <label for="http-post">POST</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="http-patch">
                <label for="http-patch">PATCH</label>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="http-delete">
                <label for="http-delete">DELETE</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- GENERATE BUTTON -->
      <button class="generate-btn" onclick="generateApexClass()">Generate Apex Class →</button>

      <!-- OUTPUT -->
      <div class="code-card" style="margin-top:24px;">
        <div class="code-header">
          <span class="code-label">Generated Apex Code</span>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="code-tag tag-apex">Apex</span>
            <button class="copy-btn" id="copy-apex-btn" onclick="copyApexCode()">COPY</button>
          </div>
        </div>
        <pre id="apex-output" style="max-height:500px;overflow-y:auto;"><span class="cmt">// Click "Generate Apex Class →" to create your code</span></pre>
      </div>

    </section>

    <!-- TRIGGER FRAMEWORK -->
    <section class="panel" id="trigger">
      <div class="panel-header">
        <div class="panel-eyebrow">Architecture</div>
        <div class="panel-title">Trigger Framework</div>
        <div class="panel-desc">One trigger per object. All logic delegated to handler classes. No business logic in .trigger files.</div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">AccountTrigger.trigger</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="cmt">// Thin trigger — context routing only</span>
<span class="ann">trigger</span> <span class="cls">AccountTrigger</span> <span class="kw">on</span> <span class="cls">Account</span> (
    before insert, before update, before delete,
    after insert, after update, after delete, after undelete
) {
    <span class="cls">AccountTriggerHandler</span> handler = <span class="kw">new</span> <span class="cls">AccountTriggerHandler</span>();

    <span class="kw">if</span> (Trigger.isBefore) {
        <span class="kw">if</span> (Trigger.isInsert)  handler.<span class="met">onBeforeInsert</span>(Trigger.new);
        <span class="kw">if</span> (Trigger.isUpdate)  handler.<span class="met">onBeforeUpdate</span>(Trigger.new, Trigger.oldMap);
        <span class="kw">if</span> (Trigger.isDelete)  handler.<span class="met">onBeforeDelete</span>(Trigger.old);
    } <span class="kw">else</span> {
        <span class="kw">if</span> (Trigger.isInsert)   handler.<span class="met">onAfterInsert</span>(Trigger.new);
        <span class="kw">if</span> (Trigger.isUpdate)   handler.<span class="met">onAfterUpdate</span>(Trigger.new, Trigger.oldMap);
        <span class="kw">if</span> (Trigger.isDelete)   handler.<span class="met">onAfterDelete</span>(Trigger.old);
        <span class="kw">if</span> (Trigger.isUndelete) handler.<span class="met">onAfterUndelete</span>(Trigger.new);
    }
}</pre>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">AccountTriggerHandler.cls</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="ann">public class</span> <span class="cls">AccountTriggerHandler</span> {

    <span class="cmt">// before insert: set defaults, validation, field population</span>
    <span class="kw">public void</span> <span class="met">onBeforeInsert</span>(List&lt;<span class="cls">Account</span>&gt; newAccounts) {
        <span class="cls">AccountService</span>.<span class="met">setDefaultRating</span>(newAccounts);
        <span class="cls">AccountValidator</span>.<span class="met">validateRequiredFields</span>(newAccounts);
    }

    <span class="cmt">// before update: detect changes using oldMap</span>
    <span class="kw">public void</span> <span class="met">onBeforeUpdate</span>(List&lt;<span class="cls">Account</span>&gt; newAccounts,
                                 Map&lt;<span class="cls">Id</span>, <span class="cls">Account</span>&gt; oldMap) {
        List&lt;<span class="cls">Account</span>&gt; changed = <span class="kw">new</span> List&lt;<span class="cls">Account</span>&gt;();
        <span class="kw">for</span> (<span class="cls">Account</span> acc : newAccounts) {
            <span class="cls">Account</span> old = oldMap.<span class="met">get</span>(acc.Id);
            <span class="kw">if</span> (acc.BillingState != old.BillingState) {
                changed.<span class="met">add</span>(acc);
            }
        }
        <span class="kw">if</span> (!changed.<span class="met">isEmpty</span>()) {
            <span class="cls">AccountService</span>.<span class="met">recalculateTax</span>(changed);
        }
    }

    <span class="cmt">// after insert: async operations, platform events, notifications</span>
    <span class="kw">public void</span> <span class="met">onAfterInsert</span>(List&lt;<span class="cls">Account</span>&gt; newAccounts) {
        <span class="cls">AccountService</span>.<span class="met">enrichAccounts</span>(newAccounts);
        <span class="cls">PlatformEventService</span>.<span class="met">publishAccountCreated</span>(newAccounts);
    }

    <span class="kw">public void</span> <span class="met">onBeforeDelete</span>(List&lt;<span class="cls">Account</span>&gt; oldAccounts) {}
    <span class="kw">public void</span> <span class="met">onAfterUpdate</span>(List&lt;<span class="cls">Account</span>&gt; newAccs, Map&lt;<span class="cls">Id</span>, <span class="cls">Account</span>&gt; oldMap) {}
    <span class="kw">public void</span> <span class="met">onAfterDelete</span>(List&lt;<span class="cls">Account</span>&gt; oldAccounts) {}
    <span class="kw">public void</span> <span class="met">onAfterUndelete</span>(List&lt;<span class="cls">Account</span>&gt; newAccounts) {}
}</pre>
      </div>
    </section>

    <!-- LWC PATTERNS -->
    <section class="panel" id="lwc">
      <div class="panel-header">
        <div class="panel-eyebrow">Lightning Web Components</div>
        <div class="panel-title">LWC Patterns & Lifecycle</div>
        <div class="panel-desc">Modern LWC patterns covering lifecycle hooks, wire adapters, reactive properties, events, and performance optimization.</div>
      </div>

      <!-- LIFECYCLE HOOKS -->
      <div style="font-size:10px;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);margin-bottom:12px;font-weight:700;">Component Lifecycle Hooks</div>
      <div class="lifecycle-grid">
        <div class="lifecycle-card">
          <div class="lifecycle-name">constructor()</div>
          <div class="lifecycle-when">Called when: Component is created (before inserted into DOM)</div>
          <div class="lifecycle-desc">
            First hook fired. Component not yet attached to DOM — no access to host element, attributes, or public properties. Cannot access child elements. Must call super() first. Use for initializing component state only.
          </div>
          <div class="lifecycle-use">
            <strong>Use for:</strong> Initialize non-reactive class properties, set default values<br>
            <strong>Don't:</strong> Access this.template, modify DOM, or call external APIs
          </div>
        </div>

        <div class="lifecycle-card">
          <div class="lifecycle-name">connectedCallback()</div>
          <div class="lifecycle-when">Called when: Component inserted into DOM</div>
          <div class="lifecycle-desc">
            Most important hook for initialization. Component is now in DOM but not yet rendered. Fires every time component is inserted (can fire multiple times if component is moved). Safe to access host element via this.template. Perfect for subscriptions, event listeners, and data fetching.
          </div>
          <div class="lifecycle-use">
            <strong>Use for:</strong> Subscribe to events, fetch initial data, register message channel subscribers, set up event listeners<br>
            <strong>Example:</strong> Subscribe to Platform Events, Lightning Message Service
          </div>
        </div>

        <div class="lifecycle-card">
          <div class="lifecycle-name">renderedCallback()</div>
          <div class="lifecycle-when">Called when: Component finishes rendering (after every render)</div>
          <div class="lifecycle-desc">
            Fires after every render cycle — can fire multiple times. Component and children are fully rendered. Use sparingly — infinite loops possible if you mutate reactive properties here. Ideal for DOM manipulation, focusing elements, or initializing third-party libraries that require rendered DOM.
          </div>
          <div class="lifecycle-use">
            <strong>Use for:</strong> Focus an input, initialize third-party JS libraries (charts, maps), measure DOM element dimensions<br>
            <strong>Warning:</strong> Don't update @track/@api properties here (causes re-render loop)
          </div>
        </div>

        <div class="lifecycle-card">
          <div class="lifecycle-name">disconnectedCallback()</div>
          <div class="lifecycle-when">Called when: Component removed from DOM</div>
          <div class="lifecycle-desc">
            Cleanup hook. Fires when component is removed from DOM (navigation, conditional rendering). Essential for preventing memory leaks — unsubscribe from events, clear intervals/timeouts, cancel pending async operations. Does not fire on page refresh (entire page unloads).
          </div>
          <div class="lifecycle-use">
            <strong>Use for:</strong> Unsubscribe from Platform Events, LMS channels, remove event listeners, clear setInterval/setTimeout<br>
            <strong>Critical:</strong> Always pair connectedCallback subscriptions with disconnectedCallback cleanup
          </div>
        </div>

        <div class="lifecycle-card">
          <div class="lifecycle-name">errorCallback(error, stack)</div>
          <div class="lifecycle-when">Called when: Error in child component's lifecycle hook or event handler</div>
          <div class="lifecycle-desc">
            Error boundary for child components. Catches errors from descendant components, not from the component itself. Use to display fallback UI or log errors to external service. Error propagates up tree — parent's errorCallback catches if child doesn't handle it.
          </div>
          <div class="lifecycle-use">
            <strong>Use for:</strong> Log errors to analytics, display error messages to users, render fallback UI<br>
            <strong>Note:</strong> Only catches errors in children, not in own component
          </div>
        </div>
      </div>

      <!-- WIRE VS IMPERATIVE -->
      <div class="code-card">
        <div class="code-header">
          <span class="code-label">@wire vs Imperative Apex — When to Use Each</span>
          <span class="code-tag tag-lwc">Best Practices</span>
        </div>
        <pre><span class="cmt">// ── @wire: Use for REACTIVE data that auto-refreshes ──</span>
<span class="kw">import</span> { wire } <span class="kw">from</span> <span class="str">'lwc'</span>;
<span class="kw">import</span> getAccounts <span class="kw">from</span> <span class="str">'@salesforce/apex/AccountController.getAccounts'</span>;

<span class="ann">@wire</span>(getAccounts, { status: <span class="str">'$filterStatus'</span> })
wiredAccounts({ error, data }) {
    <span class="kw">if</span> (data) {
        this.accounts = data;
        this.error = <span class="kw">undefined</span>;
    } <span class="kw">else if</span> (error) {
        this.error = error;
        this.accounts = <span class="kw">undefined</span>;
    }
}

<span class="cmt">// When filterStatus changes, @wire automatically re-fetches data
// Use @wire for: read-only data, lists that update based on filters, dashboard widgets</span>

<span class="cmt">// ── Imperative: Use for USER-TRIGGERED actions (button clicks) ──</span>
<span class="kw">import</span> createAccount <span class="kw">from</span> <span class="str">'@salesforce/apex/AccountController.createAccount'</span>;

<span class="kw">async</span> <span class="met">handleSave</span>() {
    this.isLoading = <span class="kw">true</span>;
    <span class="kw">try</span> {
        <span class="kw">const</span> result = <span class="kw">await</span> <span class="met">createAccount</span>({ name: this.accountName });
        this.<span class="met">dispatchEvent</span>(<span class="kw">new</span> ShowToastEvent({ 
            title: <span class="str">'Success'</span>, 
            message: <span class="str">'Account created'</span>, 
            variant: <span class="str">'success'</span> 
        }));
        <span class="cmt">// Refresh wire adapter data after mutation</span>
        <span class="kw">await</span> <span class="met">refreshApex</span>(this.wiredAccountsResult);
    } <span class="kw">catch</span> (error) {
        this.<span class="met">handleError</span>(error);
    } <span class="kw">finally</span> {
        this.isLoading = <span class="kw">false</span>;
    }
}

<span class="cmt">// Use imperative for: DML operations, user-triggered actions, one-time fetches</span></pre>
      </div>

      <!-- @track DEPRECATION -->
      <div class="warning-box">
        <div class="warning-box-title">⚠ @track is Deprecated</div>
        <div class="warning-box-text">
          As of Winter '23, <code>@track</code> is no longer needed for primitive reactivity. All fields are reactive by default. Only use <code>@track</code> for objects/arrays when you need to trigger re-render on nested property mutation: <code>this.account.name = 'New'</code> (won't re-render without @track on the object). Best practice: use spread operator to create new object instead of mutating: <code>this.account = {...this.account, name: 'New'}</code> (triggers reactivity without @track).
        </div>
      </div>

      <!-- FULL EXAMPLE WITH LIFECYCLE -->
      <div class="code-card">
        <div class="code-header">
          <span class="code-label">accountManager.js — Complete Lifecycle Example</span>
          <span class="code-tag tag-lwc">LWC</span>
        </div>
        <pre><span class="kw">import</span> { LightningElement, api, wire } <span class="kw">from</span> <span class="str">'lwc'</span>;
<span class="kw">import</span> { getRecord, getFieldValue, updateRecord } <span class="kw">from</span> <span class="str">'lightning/uiRecordApi'</span>;
<span class="kw">import</span> { refreshApex } <span class="kw">from</span> <span class="str">'@salesforce/apex'</span>;
<span class="kw">import</span> { ShowToastEvent } <span class="kw">from</span> <span class="str">'lightning/platformShowToastEvent'</span>;
<span class="kw">import</span> { 
    subscribe, unsubscribe, onError 
} <span class="kw">from</span> <span class="str">'lightning/empApi'</span>;

<span class="kw">import</span> NAME_FIELD <span class="kw">from</span> <span class="str">'@salesforce/schema/Account.Name'</span>;
<span class="kw">import</span> REVENUE_FIELD <span class="kw">from</span> <span class="str">'@salesforce/schema/Account.AnnualRevenue'</span>;

<span class="kw">export default class</span> <span class="cls">AccountManager</span> <span class="kw">extends</span> LightningElement {
    <span class="ann">@api</span> recordId;
    wiredAccountResult;
    platformEventSubscription;
    isLoading = <span class="kw">false</span>;
    error;

    <span class="cmt">// ── CONSTRUCTOR: Initialize non-reactive state ──</span>
    <span class="met">constructor</span>() {
        <span class="kw">super</span>();
        <span class="cmt">// Can't access this.template yet</span>
        this.hasInitialized = <span class="kw">false</span>;
    }

    <span class="cmt">// ── CONNECTED: Subscribe to Platform Events ──</span>
    <span class="met">connectedCallback</span>() {
        this.<span class="met">subscribeToPlatformEvents</span>();
        this.<span class="met">registerErrorListener</span>();
    }

    <span class="cmt">// ── WIRE: Reactive data fetching ──</span>
    <span class="ann">@wire</span>(getRecord, {
        recordId: <span class="str">'$recordId'</span>,
        fields: [NAME_FIELD, REVENUE_FIELD]
    })
    wiredAccount(result) {
        this.wiredAccountResult = result;
        <span class="kw">if</span> (result.error) {
            this.error = result.error.body.message;
        }
    }

    <span class="cmt">// ── RENDERED: DOM is ready, focus input if first render ──</span>
    <span class="met">renderedCallback</span>() {
        <span class="kw">if</span> (!this.hasInitialized) {
            <span class="kw">const</span> input = this.template.<span class="met">querySelector</span>(<span class="str">'lightning-input'</span>);
            <span class="kw">if</span> (input) {
                input.<span class="met">focus</span>();
                this.hasInitialized = <span class="kw">true</span>;
            }
        }
    }

    <span class="cmt">// ── DISCONNECTED: Cleanup subscriptions ──</span>
    <span class="met">disconnectedCallback</span>() {
        <span class="kw">if</span> (this.platformEventSubscription) {
            <span class="met">unsubscribe</span>(this.platformEventSubscription, response => {
                console.<span class="met">log</span>(<span class="str">'Unsubscribed from Platform Event'</span>);
            });
        }
    }

    <span class="cmt">// ── ERROR BOUNDARY: Catch errors from child components ──</span>
    <span class="met">errorCallback</span>(error, stack) {
        console.<span class="met">error</span>(<span class="str">'Error from child component:'</span>, error, stack);
        this.error = <span class="str">'Something went wrong. Please refresh.'</span>;
    }

    <span class="cmt">// ── GETTERS: Computed properties ──</span>
    <span class="kw">get</span> accountName() {
        <span class="kw">return</span> <span class="met">getFieldValue</span>(this.wiredAccountResult.data, NAME_FIELD);
    }

    <span class="kw">get</span> hasError() {
        <span class="kw">return</span> !!this.error;
    }

    <span class="cmt">// ── PLATFORM EVENTS: Subscribe in connected, unsubscribe in disconnected ──</span>
    <span class="met">subscribeToPlatformEvents</span>() {
        <span class="kw">const</span> channelName = <span class="str">'/event/Account_Updated__e'</span>;
        <span class="met">subscribe</span>(channelName, -<span class="num">1</span>, response => {
            <span class="kw">const</span> payload = response.data.payload;
            <span class="kw">if</span> (payload.Account_Id__c === this.recordId) {
                <span class="met">refreshApex</span>(this.wiredAccountResult);
            }
        }).<span class="met">then</span>(subscription => {
            this.platformEventSubscription = subscription;
        });
    }

    <span class="met">registerErrorListener</span>() {
        <span class="met">onError</span>(error => {
            console.<span class="met">error</span>(<span class="str">'Platform Event Error:'</span>, error);
        });
    }

    <span class="cmt">// ── USER ACTIONS: Imperative Apex calls ──</span>
    <span class="kw">async</span> <span class="met">handleSave</span>() {
        this.isLoading = <span class="kw">true</span>;
        <span class="kw">try</span> {
            <span class="kw">const</span> fields = { Id: this.recordId, Name: this.accountName };
            <span class="kw">await</span> <span class="met">updateRecord</span>({ fields });
            <span class="kw">await</span> <span class="met">refreshApex</span>(this.wiredAccountResult);
            this.<span class="met">dispatchEvent</span>(<span class="kw">new</span> ShowToastEvent({
                title: <span class="str">'Success'</span>,
                message: <span class="str">'Account updated'</span>,
                variant: <span class="str">'success'</span>
            }));
        } <span class="kw">catch</span> (error) {
            this.error = error.body.message;
        } <span class="kw">finally</span> {
            this.isLoading = <span class="kw">false</span>;
        }
    }
}</pre>
      </div>

      <!-- PERFORMANCE BEST PRACTICES -->
      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Performance & Memory Best Practices</span>
          <span class="code-tag tag-info">Optimization</span>
        </div>
        <pre><span class="cmt">// ── 1. Use getters for computed properties (cached until dependency changes) ──</span>
<span class="kw">get</span> filteredAccounts() {
    <span class="kw">return</span> this.accounts.filter(a => a.AnnualRevenue > <span class="num">1000000</span>);
}
<span class="cmt">// Better than computing in template: {filteredAccounts} vs {accounts.filter(...)}</span>

<span class="cmt">// ── 2. Debounce user input to reduce server calls ──</span>
<span class="met">handleSearchChange</span>(event) {
    window.<span class="met">clearTimeout</span>(this.delayTimeout);
    <span class="kw">const</span> searchKey = event.target.value;
    this.delayTimeout = <span class="met">setTimeout</span>(() => {
        this.searchKey = searchKey;  <span class="cmt">// This triggers @wire re-fetch</span>
    }, <span class="num">300</span>);
}

<span class="cmt">// ── 3. Use if:true/if:false for conditional rendering (not display: none) ──</span>
<span class="cmt">// ✓ GOOD: Component not created at all if condition false</span>
<span class="op">&lt;</span><span class="cls">template</span> lwc:if={showDetails}<span class="op">&gt;</span>
    <span class="op">&lt;</span>c-expensive-component<span class="op">&gt;&lt;/</span>c-expensive-component<span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">template</span><span class="op">&gt;</span>
<span class="cmt">// ✗ BAD: Component created but hidden (wastes memory)</span>
<span class="op">&lt;</span><span class="kw">div</span> style={hideStyle}<span class="op">&gt;</span><span class="op">&lt;</span>c-expensive-component<span class="op">&gt;&lt;/</span>c-expensive-component<span class="op">&gt;&lt;/</span><span class="kw">div</span><span class="op">&gt;</span>

<span class="cmt">// ── 4. Avoid renderedCallback infinite loops ──</span>
<span class="met">renderedCallback</span>() {
    <span class="cmt">// ✗ BAD: Causes infinite re-render</span>
    <span class="cmt">// this.count++;</span>
    
    <span class="cmt">// ✓ GOOD: Use flag to run only once</span>
    <span class="kw">if</span> (!this.chartInitialized) {
        this.<span class="met">initializeChart</span>();
        this.chartInitialized = <span class="kw">true</span>;
    }
}

<span class="cmt">// ── 5. Clean up in disconnectedCallback to prevent memory leaks ──</span>
<span class="met">connectedCallback</span>() {
    this.intervalId = <span class="met">setInterval</span>(() => this.<span class="met">refreshData</span>(), <span class="num">5000</span>);
}
<span class="met">disconnectedCallback</span>() {
    <span class="kw">if</span> (this.intervalId) {
        <span class="met">clearInterval</span>(this.intervalId);
    }
}</pre>
      </div>

    </section>

    <!-- CODE REVIEW -->
    <section class="panel" id="review">
      <div class="panel-header">
        <div class="panel-eyebrow">Quality Gate</div>
        <div class="panel-title">Code Review Checklist</div>
        <div class="panel-desc">Run through this before every PR. Catches the most common Salesforce-specific issues.</div>
      </div>

      <ul class="checklist">
        <li class="check-item">
          <span class="check-icon pass">✓</span>
          <div><strong>No SOQL/DML inside loops.</strong> All queries are before loops; results stored in Maps for O(1) access inside loop bodies.</div>
        </li>
        <li class="check-item">
          <span class="check-icon pass">✓</span>
          <div><strong>Trigger is thin.</strong> Zero business logic in .trigger file — all work delegated to a handler class.</div>
        </li>
        <li class="check-item">
          <span class="check-icon pass">✓</span>
          <div><strong>Code handles bulk.</strong> All methods accept List/Map arguments. Nothing assumes Trigger.new has exactly 1 record.</div>
        </li>
        <li class="check-item">
          <span class="check-icon pass">✓</span>
          <div><strong>Error handling is present.</strong> Database.SaveResult errors are checked; exceptions are caught and logged — not swallowed silently.</div>
        </li>
        <li class="check-item">
          <span class="check-icon pass">✓</span>
          <div><strong>Tests use @TestSetup</strong> and cover negative cases (bulk of 200, exceptions, partial failures). Assert on specifics, not just "no exception".</div>
        </li>
        <li class="check-item">
          <span class="check-icon warn">⚠</span>
          <div><strong>Review sharing model.</strong> Does the class need <code>with sharing</code> or <code>without sharing</code>? Is it intentional?</div>
        </li>
        <li class="check-item">
          <span class="check-icon warn">⚠</span>
          <div><strong>Callout + DML ordering.</strong> If method does callouts AND DML, callouts must complete before any DML (or use @future).</div>
        </li>
        <li class="check-item">
          <span class="check-icon warn">⚠</span>
          <div><strong>No hardcoded IDs.</strong> RecordTypeId, ProfileId, etc. must be queried by DeveloperName — not hardcoded org-specific IDs.</div>
        </li>
        <li class="check-item">
          <span class="check-icon fail">✗</span>
          <div><strong>No String.format SOQL.</strong> Dynamic SOQL must sanitize inputs with <code>String.escapeSingleQuotes()</code> to prevent injection.</div>
        </li>
        <li class="check-item">
          <span class="check-icon fail">✗</span>
          <div><strong>No SELECT *.</strong> Always specify exact fields. Wildcard queries are not supported and specifying all fields causes unnecessary data transfer.</div>
        </li>
      </ul>
    </section>

    <!-- TEST PATTERNS -->
    <section class="panel" id="test">
      <div class="panel-header">
        <div class="panel-eyebrow">Testing</div>
        <div class="panel-title">Test Class Patterns</div>
        <div class="panel-desc">Salesforce requires 75% code coverage for production deployment. Aim for meaningful tests, not line-filling.</div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">AccountServiceTest.cls — Production Pattern</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="ann">@IsTest</span>
<span class="ann">private class</span> <span class="cls">AccountServiceTest</span> {

    <span class="ann">@TestSetup</span>  <span class="cmt">// Runs once; data is rolled back between tests</span>
    <span class="kw">static void</span> <span class="met">setupData</span>() {
        List&lt;<span class="cls">Account</span>&gt; accounts = <span class="kw">new</span> List&lt;<span class="cls">Account</span>&gt;();
        <span class="kw">for</span> (Integer i = <span class="num">0</span>; i &lt; <span class="num">200</span>; i++) {   <span class="cmt">// Always test bulk (200)</span>
            accounts.<span class="met">add</span>(<span class="kw">new</span> <span class="cls">Account</span>(
                Name = <span class="str">'Test Account '</span> + i,
                AnnualRevenue = i * <span class="num">10000</span>
            ));
        }
        <span class="met">insert</span> accounts;
    }

    <span class="ann">@IsTest</span>
    <span class="kw">static void</span> <span class="met">testEnrichAccounts_Positive</span>() {
        List&lt;<span class="cls">Account</span>&gt; accounts = [
            <span class="kw">SELECT</span> Id, Name, AnnualRevenue
            <span class="kw">FROM</span> Account <span class="kw">WHERE</span> Name LIKE <span class="str">'Test Account%'</span>
        ];

        Test.<span class="met">startTest</span>();   <span class="cmt">// Resets governor limits</span>
        <span class="cls">AccountService</span>.<span class="met">enrichAccounts</span>(accounts);
        Test.<span class="met">stopTest</span>();    <span class="cmt">// Forces async code to complete</span>

        List&lt;<span class="cls">Account</span>&gt; updated = [
            <span class="kw">SELECT</span> Id, Rating <span class="kw">FROM</span> Account
            <span class="kw">WHERE</span> Id <span class="kw">IN</span> :accounts
            <span class="kw">AND</span> AnnualRevenue &gt; <span class="num">1000000</span>
        ];
        <span class="kw">for</span> (<span class="cls">Account</span> acc : updated) {
            System.<span class="met">assertEquals</span>(<span class="str">'Hot'</span>, acc.Rating,
                <span class="str">'High revenue accounts should be Hot'</span>);
        }
    }

    <span class="ann">@IsTest</span>
    <span class="kw">static void</span> <span class="met">testEnrichAccounts_EmptyList</span>() {
        Test.<span class="met">startTest</span>();
        <span class="kw">try</span> {
            <span class="cls">AccountService</span>.<span class="met">enrichAccounts</span>(<span class="kw">new</span> List&lt;<span class="cls">Account</span>&gt;());
            System.<span class="met">assert</span>(<span class="kw">true</span>, <span class="str">'Should handle empty list gracefully'</span>);
        } <span class="kw">catch</span> (Exception e) {
            System.<span class="met">assert</span>(<span class="kw">false</span>,
                <span class="str">'Should not throw on empty list: '</span> + e.getMessage());
        }
        Test.<span class="met">stopTest</span>();
    }

    <span class="ann">@IsTest</span>
    <span class="kw">static void</span> <span class="met">testBatch_EndToEnd</span>() {
        Test.<span class="met">startTest</span>();
        Database.<span class="cls">BatchableContext</span> bc;
        Id batchId = Database.<span class="met">executeBatch</span>(<span class="kw">new</span> <span class="cls">AccountBatch</span>(), <span class="num">200</span>);
        Test.<span class="met">stopTest</span>();   <span class="cmt">// Batch runs synchronously in test context</span>

        <span class="cmt">// Verify batch processed correctly</span>
        Integer hotCount = [
            <span class="kw">SELECT COUNT</span>() <span class="kw">FROM</span> Account
            <span class="kw">WHERE</span> Rating = <span class="str">'Hot'</span>
            <span class="kw">AND</span> AnnualRevenue &gt; <span class="num">1000000</span>
        ];
        System.<span class="met">assertNotEquals</span>(<span class="num">0</span>, hotCount, <span class="str">'Should have Hot accounts'</span>);
    }
}</pre>
      </div>
    </section>

    <!-- MULESOFT HANDBOOK -->
    <section class="panel" id="mule-handbook">
      <div class="panel-header">
        <div class="panel-eyebrow">Integration Deep Dive</div>
        <div class="panel-title">MuleSoft ↔ Salesforce Handbook</div>
        <div class="panel-desc">Edge cases, pitfalls, and battle-tested patterns for MuleSoft-Salesforce integrations. What to solve in Mule vs. Salesforce, and how to avoid the common traps.</div>
      </div>

      <!-- EDGE CASE 1 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">⚠️</div>
          <div>
            <div class="edge-case-title">Edge Case: Platform Event Replay After Mule Downtime</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft subscriber goes offline for 30 minutes. When it reconnects, it misses 200 events published during downtime. Platform Events only retain events for 24-72 hours depending on event type. How do you guarantee no data loss?
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'replay-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'replay-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="replay-mule">
          <h4>MuleSoft Solution: Pub/Sub API with Durable Subscription</h4>
          <p>Use the Salesforce Pub/Sub API (gRPC) with a durable subscription. Each subscriber maintains a replay ID cursor. When Mule reconnects, it automatically resumes from the last processed event.</p>
          <ul>
            <li>Configure MuleSoft to use gRPC Pub/Sub API instead of CometD Streaming API</li>
            <li>Store the last successful replay ID in a persistent store (database, Redis)</li>
            <li>On reconnect, resume from stored replay ID</li>
            <li>Set replay preset to CUSTOM and pass the stored replay ID</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Why This Works</div>
            <div class="info-box-text">Pub/Sub API maintains event retention for 24-72 hours. Durable subscriptions survive Mule restarts. You can replay missed events as long as they're within retention window.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="replay-sf">
          <h4>Salesforce Solution: Change Data Capture + Batch Recovery</h4>
          <p>Instead of Platform Events, use Change Data Capture. CDC provides a guaranteed replay buffer. Combine with a nightly batch job as safety net.</p>
          <ul>
            <li>Enable Change Data Capture on critical objects instead of Platform Events</li>
            <li>CDC retains all changes for 3 days minimum (up to 30 days with Event Relay)</li>
            <li>Build an Apex Batch job that runs hourly to sync any records updated in last 2 hours</li>
            <li>Batch job acts as reconciliation — catches anything Mule missed</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Trade-off</div>
            <div class="warning-box-text">CDC has longer retention but higher licensing cost. Batch job adds complexity. Use this when missing events has severe business impact (financial transactions, compliance data).</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 2 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">🔄</div>
          <div>
            <div class="edge-case-title">Edge Case: Circular Update Loop (SF → Mule → SF)</div>
            <div class="edge-case-scenario">
              Scenario: Opportunity update in Salesforce triggers Platform Event → MuleSoft enriches data from ERP → Mule upserts back to SF → this triggers another Platform Event → infinite loop crashes both systems.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'loop-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'loop-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="loop-mule">
          <h4>MuleSoft Solution: Idempotency Header + Correlation ID</div>
          <p>Add a custom header to every Mule → SF upsert request. Salesforce trigger checks this header and skips Platform Event publish if present.</p>
          <ul>
            <li>Mule sets HTTP header: <code>X-Integration-Source: MuleSoft</code></li>
            <li>Mule sets unique correlation ID: <code>X-Correlation-Id: uuid</code></li>
            <li>Salesforce trigger checks <code>Request.getCurrent().getHeader('X-Integration-Source')</code></li>
            <li>If header equals 'MuleSoft', skip Platform Event publish</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Limitation</div>
            <div class="warning-box-text">This only works for API-based updates. If Mule uses Bulk API 2.0, headers are not available in triggers. Use Salesforce solution instead.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="loop-sf">
          <h4>Salesforce Solution: Integration User + Bypass Flag</h4>
          <p>Create a dedicated Integration User for Mule. Trigger checks running user and skips Platform Event publish if it's the integration user.</p>
          <ul>
            <li>Create Salesforce user: <code>mulesoft.integration@yourcompany.com</code></li>
            <li>Grant this user a custom Permission Set: <code>Integration_User_Bypass</code></li>
            <li>In trigger: <code>if (!FeatureManagement.checkPermission('Integration_User_Bypass')) { publishEvent(); }</code></li>
            <li>All Mule API calls authenticate as this user</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Best Practice</div>
            <div class="info-box-text">This pattern scales well. Works with Bulk API, REST API, and SOAP API. Easy to audit — all integration updates show as single user in field history.</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 3 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">⏱️</div>
          <div>
            <div class="edge-case-title">Edge Case: Bulk API Job Exceeds 24-Hour Processing Time</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft submits a Bulk API 2.0 job with 5 million records. Salesforce takes 26 hours to process it. Job times out. You lose partial results and can't easily identify which records failed.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'bulk-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'bulk-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="bulk-mule">
          <h4>MuleSoft Solution: Chunking + Parallel Job Submission</h4>
          <p>Split the 5M records into 50 separate Bulk API jobs of 100k each. Submit them in parallel with max concurrency of 10 jobs at a time.</p>
          <ul>
            <li>Use DataWeave to split CSV into 100k-row chunks</li>
            <li>Submit each chunk as separate Bulk API job</li>
            <li>Use Scatter-Gather pattern with 10 parallel routes</li>
            <li>Poll each job independently until complete</li>
            <li>Aggregate failed records from all jobs into single retry file</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Performance Gain</div>
            <div class="info-box-text">10 parallel jobs finish in ~3 hours vs. 1 massive job taking 26+ hours. Easier to retry small failed chunks. Each job stays well under 24hr limit.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="bulk-sf">
          <h4>Salesforce Solution: Apex Batch + Platform Events for Progress</h4>
          <p>Don't use Bulk API for data already in Salesforce. Use Apex Batch to process in chunks with progress tracking via Platform Events.</p>
          <ul>
            <li>Mule triggers an Apex REST endpoint to initiate batch job</li>
            <li>Apex Batch processes records in 200-record chunks (well under governor limits)</li>
            <li>Each chunk publishes a Progress Platform Event with success/failure count</li>
            <li>Mule subscribes to progress events and monitors completion</li>
            <li>No 24-hour timeout risk — Batch Apex has separate limits</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">When to Use</div>
            <div class="warning-box-text">Only use this if data is already in Salesforce. For external → SF data loads, Mule chunking is faster. Apex Batch max: 5 jobs queued at once.</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 4 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">🔐</div>
          <div>
            <div class="edge-case-title">Edge Case: OAuth Token Expires Mid-Job (15-minute Expiry)</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft starts a long-running process that makes incremental Salesforce API calls over 2 hours. After 15 minutes, the OAuth access token expires. Subsequent API calls fail with 401 Unauthorized. Entire process crashes.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'token-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'token-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="token-mule">
          <h4>MuleSoft Solution: Proactive Token Refresh with Interceptor</h4>
          <p>Implement a custom Mule interceptor that checks token expiry before each API call and refreshes proactively.</p>
          <ul>
            <li>Store token metadata: <code>{ access_token, issued_at, expires_in }</code></li>
            <li>Before each SF API call, check: <code>if (now - issued_at > expires_in - 60s) refresh()</code></li>
            <li>Refresh 60 seconds before actual expiry (safety buffer)</li>
            <li>Use OAuth refresh token flow: <code>POST /services/oauth2/token</code> with <code>grant_type=refresh_token</code></li>
            <li>Update stored access_token and issued_at atomically</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Recommended Approach</div>
            <div class="info-box-text">This prevents all 401 errors. MuleSoft Salesforce Connector handles this automatically, but if using HTTP Request connector, implement this manually.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="token-sf">
          <h4>Salesforce Solution: Use Session ID with Connected App</h4>
          <p>Instead of OAuth access tokens (15-min expiry), use Salesforce Session ID which lasts 2+ hours (configurable up to 12 hours).</p>
          <ul>
            <li>Mule authenticates via SOAP login() call instead of OAuth</li>
            <li>SOAP login returns sessionId with much longer expiry</li>
            <li>Configure Session Settings in Salesforce: Setup → Session Settings → Timeout = 12 hours</li>
            <li>sessionId valid for entire session duration</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Security Trade-off</div>
            <div class="warning-box-text">Session IDs are less secure than short-lived OAuth tokens. Only use for trusted internal integrations. Not recommended for public-facing APIs.</div>
          </div>
        </div>
      </div>

      <!-- BEST PRACTICES SECTION -->
      <div style="font-size:11px;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);margin:40px 0 20px;font-weight:700;border-top:1px solid var(--border);padding-top:24px;">📋 MuleSoft ↔ Salesforce Best Practices</div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">🔐</div>
          <div class="bp-title">Authentication & Security</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Use OAuth 2.0 JWT Bearer flow (not username-password)</div>
              <div class="bp-detail">Server-to-server auth without user interaction. Rotate certificates annually. Store private keys in secure vault (Anypoint Secrets Manager).</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Create dedicated Integration User with minimal permissions</div>
              <div class="bp-detail">Never use admin credentials. Grant only necessary object/field permissions via Permission Set. Easier to audit and revoke access.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Implement IP whitelisting on both sides</div>
              <div class="bp-detail">Salesforce: Restrict Connected App to Mule's IP range. Mule: Use Anypoint VPC to lock down egress IPs.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">📊</div>
          <div class="bp-title">Data Sync & Idempotency</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Always upsert by External ID — never query-then-insert</div>
              <div class="bp-detail">Mark Integration_Id__c field as externalId=true and unique=true. Mule upserts using this field. Eliminates race conditions and duplicate records.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Design all endpoints to be idempotent</div>
              <div class="bp-detail">Same request processed multiple times produces same result. Use correlation IDs to detect duplicate requests. Store processed IDs in Redis/database with 24hr TTL.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Use Bulk API 2.0 for >2,000 records</div>
              <div class="bp-detail">Bulk API 2.0 is faster and more reliable than REST API for large data volumes. Auto-batches into 10k chunks. Provides per-record success/failure tracking.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Implement delta sync with Last Modified Date</div>
              <div class="bp-detail">Don't sync full dataset every run. Query: <code>WHERE LastModifiedDate > :lastSyncTime</code>. Store last sync timestamp in persistent store. Reduces API consumption by 95%+.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">🚨</div>
          <div class="bp-title">Error Handling & Monitoring</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Never lose data — implement DLQ (Dead Letter Queue)</div>
              <div class="bp-detail">Failed records → DLQ (persistent queue). Separate process retries DLQ records hourly with exponential backoff. Alert if DLQ size > threshold.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Distinguish transient vs. permanent failures</div>
              <div class="bp-detail">Transient (network timeout, 503): Retry with backoff. Permanent (400 validation error, duplicate): Don't retry, log to error table for manual review.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Set up proactive alerting on key metrics</div>
              <div class="bp-detail">Alert on: API call failures > 5%, Bulk job processing time > 2hr, Platform Event lag > 5 min, OAuth token refresh failures. Use Anypoint Monitoring + PagerDuty.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Log correlation IDs end-to-end for traceability</div>
              <div class="bp-detail">Generate UUID in Mule entry point. Pass as <code>X-Correlation-Id</code> header to all downstream calls. Log it in Salesforce triggers. Enables tracing request across both systems.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">⚡</div>
          <div class="bp-title">Performance & Scalability</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Use Parallel Processing for independent operations</div>
              <div class="bp-detail">Scatter-Gather pattern: Query 3 objects in parallel vs. sequentially. Reduces total latency by 60%+. Max 10 parallel routes to avoid overwhelming SF.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Cache reference data (RecordTypes, Picklists) in Mule</div>
              <div class="bp-detail">Don't query RecordTypeId on every record. Cache in Object Store with 24hr TTL. Refresh cache daily via scheduled flow. Saves 1000s of SOQL queries.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">✓</div>
            <div>
              <div class="bp-text">Throttle API calls to stay under rate limits</div>
              <div class="bp-detail">SF rate limit: 100 API calls/user/20s. Use Rate Limiting policy in Anypoint to enforce 80 calls/20s per user. Prevents 503 errors during peak load.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Complete Mule Flow Example — Idempotent Upsert with Error Handling</span>
          <span class="code-tag tag-info">Mule DSL</span>
        </div>
        <pre><span class="op">&lt;</span><span class="cls">flow</span> name=<span class="str">"sync-accounts-to-salesforce"</span><span class="op">&gt;</span>
  <span class="cmt">&lt;!-- 1. Generate correlation ID for tracing --&gt;</span>
  <span class="op">&lt;</span><span class="cls">set-variable</span> variableName=<span class="str">"correlationId"</span> 
                value=<span class="str">"#[uuid()]"</span> /&gt;
  
  <span class="cmt">&lt;!-- 2. Transform ERP data to Salesforce format --&gt;</span>
  <span class="op">&lt;</span><span class="cls">ee:transform</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">ee:message</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">ee:set-payload</span><span class="op">&gt;</span>
        %dw 2.0
        output application/json
        ---
        payload map {
          Integration_Id__c: $.erpAccountId,
          Name: $.accountName,
          BillingStreet: $.address.street,
          AnnualRevenue: $.revenue as Number,
          <span class="cmt">// Correlation ID for idempotency check in SF</span>
          Correlation_Id__c: vars.correlationId
        }
      <span class="op">&lt;/</span><span class="cls">ee:set-payload</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">ee:message</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">ee:transform</span><span class="op">&gt;</span>
  
  <span class="cmt">&lt;!-- 3. Upsert with External ID --&gt;</span>
  <span class="op">&lt;</span><span class="cls">try</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">salesforce:upsert</span>
      config-ref=<span class="str">"Salesforce_Config"</span>
      type=<span class="str">"Account"</span>
      externalIdFieldName=<span class="str">"Integration_Id__c"</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>#[payload]<span class="op">&lt;/</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">salesforce:upsert</span><span class="op">&gt;</span>
    
    <span class="cmt">&lt;!-- 4. Log success --&gt;</span>
    <span class="op">&lt;</span><span class="cls">logger</span> level=<span class="str">"INFO"</span> 
             message=<span class="str">"#['Upserted ' ++ sizeOf(payload) ++ ' accounts. Correlation: ' ++ vars.correlationId]"</span> /&gt;
    
    <span class="cmt">&lt;!-- 5. Error handling --&gt;</span>
    <span class="op">&lt;</span><span class="cls">error-handler</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">on-error-propagate</span> type=<span class="str">"SALESFORCE:CONNECTIVITY"</span><span class="op">&gt;</span>
        <span class="cmt">&lt;!-- Transient error - send to retry queue --&gt;</span>
        <span class="op">&lt;</span><span class="cls">jms:publish</span> destination=<span class="str">"salesforce-retry-queue"</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">jms:message</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="cls">jms:body</span><span class="op">&gt;</span>#[payload]<span class="op">&lt;/</span><span class="cls">jms:body</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="cls">jms:properties</span><span class="op">&gt;</span>
              #[{ correlationId: vars.correlationId, retryCount: 0 }]
            <span class="op">&lt;/</span><span class="cls">jms:properties</span><span class="op">&gt;</span>
          <span class="op">&lt;/</span><span class="cls">jms:message</span><span class="op">&gt;</span>
        <span class="op">&lt;/</span><span class="cls">jms:publish</span><span class="op">&gt;</span>
      <span class="op">&lt;/</span><span class="cls">on-error-propagate</span><span class="op">&gt;</span>
      
      <span class="op">&lt;</span><span class="cls">on-error-propagate</span> type=<span class="str">"SALESFORCE:INVALID_DATA"</span><span class="op">&gt;</span>
        <span class="cmt">&lt;!-- Permanent error - log to DLQ for manual review --&gt;</span>
        <span class="op">&lt;</span><span class="cls">db:insert</span> config-ref=<span class="str">"Database_Config"</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">db:sql</span><span class="op">&gt;</span>
            INSERT INTO error_log (correlation_id, error_type, payload, timestamp)
            VALUES (:correlationId, :errorType, :payload, NOW())
          <span class="op">&lt;/</span><span class="cls">db:sql</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">db:input-parameters</span><span class="op">&gt;</span>
            #[{
              correlationId: vars.correlationId,
              errorType: 'VALIDATION_ERROR',
              payload: write(payload, 'application/json')
            }]
          <span class="op">&lt;/</span><span class="cls">db:input-parameters</span><span class="op">&gt;</span>
        <span class="op">&lt;/</span><span class="cls">db:insert</span><span class="op">&gt;</span>
      <span class="op">&lt;/</span><span class="cls">on-error-propagate</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">error-handler</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">try</span><span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">flow</span><span class="op">&gt;</span></pre>
      </div>

    </section>

    <!-- METADATA API -->
    <section class="panel" id="metadata">
      <div class="panel-header">
        <div class="panel-eyebrow">Deployment & Configuration</div>
        <div class="panel-title">Metadata API Reference</div>
        <div class="panel-desc">The Metadata API lets you retrieve, deploy, create, update, or delete customizations in your Salesforce org — the foundation of every CI/CD pipeline.</div>
      </div>

      <div class="meta-grid">
        <div class="meta-card">
          <div class="meta-type">ApexClass</div>
          <div class="meta-file">classes/MyClass.cls + .cls-meta.xml</div>
          <div class="meta-desc">Apex class source. Version must match org API version. Always include both files in deployment.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">CustomObject</div>
          <div class="meta-file">objects/Account/Account.object-meta.xml</div>
          <div class="meta-desc">Full object definition including fields, validation rules, and page layouts in source format.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">CustomField</div>
          <div class="meta-file">objects/Account/fields/MyField__c.field-meta.xml</div>
          <div class="meta-desc">Individual field definitions. Source format splits fields into separate files per field.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">Flow</div>
          <div class="meta-file">flows/My_Flow.flow-meta.xml</div>
          <div class="meta-desc">Screen flows, auto-launched flows, record-triggered flows. Active version is deployed automatically.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">PermissionSet</div>
          <div class="meta-file">permissionsets/My_PS.permissionset-meta.xml</div>
          <div class="meta-desc">Field-level security, object permissions, Apex class access, and connected app permissions.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">LightningComponentBundle</div>
          <div class="meta-file">lwc/myComponent/ (directory)</div>
          <div class="meta-desc">All LWC files: .html, .js, .css, .js-meta.xml. The entire directory deploys as one unit.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">RemoteSiteSetting</div>
          <div class="meta-file">remoteSiteSettings/MySite.remoteSite-meta.xml</div>
          <div class="meta-desc">Required before any Apex HTTP callout to an external endpoint. Must be deployed before code using it.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">CustomMetadata</div>
          <div class="meta-file">customMetadata/Config.MDT_Record.md-meta.xml</div>
          <div class="meta-desc">Config-as-metadata. Deployable, queryable in Apex, no DML limits. Prefer over Custom Settings for config.</div>
        </div>
        <div class="meta-card">
          <div class="meta-type">NamedCredential</div>
          <div class="meta-file">namedCredentials/MyAPI.namedCredential-meta.xml</div>
          <div class="meta-desc">Stores endpoint URL + auth (OAuth, password). Use in callouts instead of hardcoding credentials in code.</div>
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">SFDX — Core Metadata Commands</span>
          <span class="code-tag tag-info">CLI</span>
        </div>
        <pre><span class="cmt"># ── Retrieve metadata from org into local source format ──</span>
sf project retrieve start \
  --metadata ApexClass:AccountService \
  --metadata CustomObject:Account \
  --target-org myorg

<span class="cmt"># Retrieve entire package</span>
sf project retrieve start --manifest manifest/package.xml --target-org myorg

<span class="cmt"># ── Deploy source to org ──</span>
sf project deploy start --source-dir force-app --target-org myorg

<span class="cmt"># Deploy with test run (required for production)</span>
sf project deploy start \
  --source-dir force-app \
  --test-level RunLocalTests \
  --target-org myorg

<span class="cmt"># Validate-only (no actual deploy — use for PR checks)</span>
sf project deploy validate \
  --source-dir force-app \
  --test-level RunLocalTests \
  --target-org myorg

<span class="cmt"># ── Quick deploy after successful validation ──</span>
sf project deploy quick --job-id &lt;validationJobId&gt; --target-org myorg

<span class="cmt"># ── Destructive changes (delete metadata) ──</span>
<span class="cmt"># Create destructiveChangesPre.xml / destructiveChangesPost.xml</span>
sf project deploy start \
  --manifest manifest/package.xml \
  --post-destructive-changes manifest/destructiveChangesPost.xml \
  --target-org myorg</pre>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">package.xml — Manifest Template</span>
          <span class="code-tag tag-info">XML</span>
        </div>
        <pre><span class="op">&lt;?</span>xml version=<span class="str">"1.0"</span> encoding=<span class="str">"UTF-8"</span><span class="op">?&gt;</span>
<span class="op">&lt;</span><span class="cls">Package</span> xmlns=<span class="str">"http://soap.sforce.com/2006/04/metadata"</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">types</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">members</span><span class="op">&gt;</span>AccountService<span class="op">&lt;/</span><span class="cls">members</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">members</span><span class="op">&gt;</span>AccountTrigger<span class="op">&lt;/</span><span class="cls">members</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">name</span><span class="op">&gt;</span>ApexClass<span class="op">&lt;/</span><span class="cls">name</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">types</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">types</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">members</span><span class="op">&gt;</span>Account<span class="op">&lt;/</span><span class="cls">members</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">name</span><span class="op">&gt;</span>CustomObject<span class="op">&lt;/</span><span class="cls">name</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">types</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">types</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">members</span><span class="op">&gt;*&lt;/</span><span class="cls">members</span><span class="op">&gt;</span>   <span class="cmt">&lt;!-- wildcard: all flows --&gt;</span>
    <span class="op">&lt;</span><span class="cls">name</span><span class="op">&gt;</span>Flow<span class="op">&lt;/</span><span class="cls">name</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">types</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">types</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">members</span><span class="op">&gt;*&lt;/</span><span class="cls">members</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">name</span><span class="op">&gt;</span>LightningComponentBundle<span class="op">&lt;/</span><span class="cls">name</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">types</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">version</span><span class="op">&gt;</span>62.0<span class="op">&lt;/</span><span class="cls">version</span><span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">Package</span><span class="op">&gt;</span></pre>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Apex Metadata API — Dynamic Field Creation</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="cmt">// Create a custom field programmatically via Apex Metadata API</span>
<span class="cls">MetadataService.MetadataPort</span> service = <span class="kw">new</span> <span class="cls">MetadataService.MetadataPort</span>();
service.SessionHeader = <span class="kw">new</span> <span class="cls">MetadataService.SessionHeader_element</span>();
service.SessionHeader.sessionId = UserInfo.<span class="met">getSessionId</span>();

<span class="cls">MetadataService.CustomField</span> customField = <span class="kw">new</span> <span class="cls">MetadataService.CustomField</span>();
customField.fullName = <span class="str">'Account.Integration_Id__c'</span>;
customField.label = <span class="str">'Integration ID'</span>;
customField.type_x = <span class="str">'Text'</span>;
customField.length = <span class="num">80</span>;
customField.externalId = <span class="kw">true</span>;    <span class="cmt">// Makes it upsertable via REST API</span>
customField.unique = <span class="kw">true</span>;

<span class="cls">MetadataService.AsyncResult</span>[] results =
    service.<span class="met">create</span>(<span class="kw">new</span> <span class="cls">MetadataService.Metadata</span>[] { customField });

<span class="cmt">// Poll until complete — Metadata API is async</span>
<span class="cls">MetadataService.AsyncResult</span>[] status;
<span class="kw">do</span> {
    status = service.<span class="met">checkStatus</span>(<span class="kw">new</span> String[]{ results[<span class="num">0</span>].id });
} <span class="kw">while</span> (!status[<span class="num">0</span>].done);</pre>
      </div>
    </section>

    <!-- FLOW DEBUGGING -->
    <section class="panel" id="flow">
      <div class="panel-header">
        <div class="panel-eyebrow">Declarative Automation</div>
        <div class="panel-title">Flow Debugging Tips</div>
        <div class="panel-desc">Flows are the #1 source of mysterious bugs in Salesforce orgs. Here's a systematic approach to finding and fixing them.</div>
      </div>

      <div class="flow-steps">
        <div class="flow-step">
          <div class="flow-step-num">1</div>
          <div>
            <div class="flow-step-title">Use Debug Mode in Flow Builder</div>
            <div class="flow-step-desc">In Flow Builder, click the bug icon (🐛) to open Debug panel. Run the flow with specific input values and trace each element's execution path, variable values at each step, and which path was taken at Decision elements.</div>
            <div class="flow-step-tip">⚡ TIP: Debug runs as your current user — switch to another user's profile in debug to test different permission scenarios.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">2</div>
          <div>
            <div class="flow-step-title">Check Flow Interview Fault Emails</div>
            <div class="flow-step-desc">When a Flow hits a fault, Salesforce emails the admin. Go to Setup → Process Automation → Paused and Failed Flow Interviews for a list of all failures. Each entry shows the fault message, the element that failed, and the flow variable state at failure time.</div>
            <div class="flow-step-tip">⚡ TIP: Add a Fault Path to every element that can fail (Get Records, DML). Route to a custom notification or platform event instead of silent failure.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">3</div>
          <div>
            <div class="flow-step-title">Enable Flow Logging in Debug Logs</div>
            <div class="flow-step-desc">Setup → Debug Logs → Add trace flag for your user. Set Workflow to FINEST and Callout to INFO. Run the automation, then search the log for "FLOW_" events to trace every element execution, every variable assignment, and every loop iteration in real time.</div>
            <div class="flow-step-tip">⚡ TIP: Filter the log with "FLOW_ELEMENT_FAULT" to jump straight to the error line.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">4</div>
          <div>
            <div class="flow-step-title">Order of Execution — Where Does Your Flow Run?</div>
            <div class="flow-step-desc">Record-Triggered Flows run in a specific position: Before-Save flows run after Apex before triggers but before validation rules. After-Save flows run after Apex after triggers. Understanding this prevents "record not saved yet" bugs and infinite loop issues.</div>
            <div class="flow-step-tip">⚡ TIP: Before-Save flows cannot do DML on the triggering record (it's not committed). Use After-Save for cross-object updates.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">5</div>
          <div>
            <div class="flow-step-title">Prevent Infinite Loops with Entry Conditions</div>
            <div class="flow-step-desc">A Flow that updates a record can retrigger itself infinitely. Always set Run Conditions to "Only when a record is created, or when a record is edited and meets the condition requirements" — and make your condition check the field value changed from something specific, not just "is not null".</div>
            <div class="flow-step-tip">⚡ TIP: Use a formula: {!$Record.Status__c} != {!$Record__Prior.Status__c} to trigger only on actual field changes.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">6</div>
          <div>
            <div class="flow-step-title">Bulkification Pitfalls in Flows</div>
            <div class="flow-step-desc">Flows are bulkified per transaction — one DML statement handles all records. But loops with Get Records inside them bypass bulkification. Use collection variables and single Get Records elements outside loops. Each DML inside a loop = one SOQL per record.</div>
            <div class="flow-step-tip">⚡ TIP: "Get Records" inside a Loop is equivalent to SOQL-in-a-loop in Apex. Move it before the loop and store results in a Collection variable.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">7</div>
          <div>
            <div class="flow-step-title">Governor Limit Errors in Flows</div>
            <div class="flow-step-desc">Flows share governor limits with Apex triggers in the same transaction. If a trigger calls a flow that calls Apex, all limits are shared. Error: "SOQL 101" or "DML 150 rows" in a flow usually means combined Apex + Flow consumption crossed the limit.</div>
            <div class="flow-step-tip">⚡ TIP: Use Setup → Platform Events → Event Log Files or Event Monitoring to see governor usage across the full transaction, not just the Apex log.</div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-step-num">8</div>
          <div>
            <div class="flow-step-title">Version Management & Rollback</div>
            <div class="flow-step-desc">Salesforce keeps all Flow versions. If a new version breaks something, go to Flow Builder → open the flow → click the version dropdown → Activate the previous version instantly. No deployment needed for rollback.</div>
            <div class="flow-step-tip">⚡ TIP: Use Flow labels that include version semantics like "Order Fulfillment v3.2 (2026-02)" so rollback history is self-documenting.</div>
          </div>
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Invoke Flow From Apex (for testing)</span>
          <span class="code-tag tag-apex">Apex</span>
        </div>
        <pre><span class="cmt">// Programmatically invoke a Flow from Apex — useful for unit testing</span>
Map&lt;String, Object&gt; inputs = <span class="kw">new</span> Map&lt;String, Object&gt;{
    <span class="str">'inputAccountId'</span> => accId,
    <span class="str">'inputStatus'</span>    => <span class="str">'Active'</span>
};

Flow.<span class="cls">Interview</span> myFlow = Flow.<span class="cls">Interview</span>.<span class="met">createInterview</span>(
    <span class="str">'Account_Enrichment_Flow'</span>, inputs
);
myFlow.<span class="met">start</span>();

<span class="cmt">// Read output variables after flow completes</span>
String result = (String) myFlow.<span class="met">getVariableValue</span>(<span class="str">'outputResult'</span>);
System.<span class="met">debug</span>(<span class="str">'Flow output: '</span> + result);

<span class="cmt">// In tests: wrap in Test.startTest/stopTest to capture async flows</span>
<span class="ann">@IsTest</span>
<span class="kw">static void</span> <span class="met">testFlowExecution</span>() {
    Account acc = <span class="kw">new</span> <span class="cls">Account</span>(Name=<span class="str">'Test'</span>);
    <span class="met">insert</span> acc;
    Test.<span class="met">startTest</span>();
    <span class="cmt">// Trigger record-triggered flow by updating the record</span>
    acc.Status__c = <span class="str">'Active'</span>;
    <span class="met">update</span> acc;
    Test.<span class="met">stopTest</span>();
    <span class="cmt">// Assert flow side-effects here</span>
    acc = [<span class="kw">SELECT</span> Rating <span class="kw">FROM</span> Account <span class="kw">WHERE</span> Id = :acc.Id];
    System.<span class="met">assertEquals</span>(<span class="str">'Hot'</span>, acc.Rating);
}</pre>
      </div>
    </section>

    <!-- INTEGRATION PATTERNS -->
    <section class="panel" id="integrations">
      <div class="panel-header">
        <div class="panel-eyebrow">Enterprise Integration</div>
        <div class="panel-title">Integration Patterns</div>
        <div class="panel-desc">Patterns for connecting Salesforce with MuleSoft, REST/SOAP APIs, ETL tools, and event-driven third-party systems.</div>
      </div>

      <div class="tab-pills">
        <div class="tab-pill active" onclick="showTab('mulesoft', this)">MuleSoft</div>
        <div class="tab-pill" onclick="showTab('rest', this)">REST / SOAP</div>
        <div class="tab-pill" onclick="showTab('events', this)">Platform Events</div>
        <div class="tab-pill" onclick="showTab('etl', this)">ETL / 3rd Party</div>
      </div>

      <!-- MULESOFT TAB -->
      <div class="tab-content active" id="tab-mulesoft">
        <div class="int-diagram">
          <div class="int-node mule">MULESOFT<br><div class="int-node-label">Anypoint Platform</div></div>
          <div class="int-arrow bi">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Connected App<br>OAuth 2.0</div>
          </div>
          <div class="int-node sf">SALESFORCE<br><div class="int-node-label">REST / Bulk API</div></div>
          <div class="int-arrow">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Outbound Msg<br>/ Platform Event</div>
          </div>
          <div class="int-node ext">ERP / EXT SYS<br><div class="int-node-label">SAP · NetSuite · etc</div></div>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Salesforce Connector — Mule 4 Config</span>
            <span class="code-tag tag-info">XML / Mule DSL</span>
          </div>
          <pre><span class="op">&lt;</span><span class="cls">salesforce:config</span> name=<span class="str">"Salesforce_Config"</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">salesforce:oauth-jwt-connection</span>
    consumerKey=<span class="str">"${sf.consumerKey}"</span>        <span class="cmt">&lt;!-- Connected App Client ID --&gt;</span>
    keyStorePath=<span class="str">"${sf.keystore.path}"</span>    <span class="cmt">&lt;!-- JWT signing cert --&gt;</span>
    storePassword=<span class="str">"${sf.keystore.pass}"</span>
    principal=<span class="str">"${sf.username}"</span>
    tokenEndpoint=<span class="str">"https://login.salesforce.com/services/oauth2/token"</span> /&gt;
<span class="op">&lt;/</span><span class="cls">salesforce:config</span><span class="op">&gt;</span>

<span class="cmt">&lt;!-- Upsert records using External ID (no SOQL needed in Mule) --&gt;</span>
<span class="op">&lt;</span><span class="cls">salesforce:upsert</span>
  config-ref=<span class="str">"Salesforce_Config"</span>
  type=<span class="str">"Account"</span>
  externalIdFieldName=<span class="str">"Integration_Id__c"</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>#[payload]<span class="op">&lt;/</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">salesforce:upsert</span><span class="op">&gt;</span>

<span class="cmt">&lt;!-- Subscribe to Platform Events from Salesforce --&gt;</span>
<span class="op">&lt;</span><span class="cls">salesforce:subscribe-topic-listener</span>
  config-ref=<span class="str">"Salesforce_Config"</span>
  topic=<span class="str">"/event/Order_Created__e"</span><span class="op">&gt;</span>
  <span class="op">&lt;</span><span class="cls">flow</span> name=<span class="str">"handleOrderCreated"</span><span class="op">&gt;</span>
    <span class="cmt">&lt;!-- Transform + route to ERP --&gt;</span>
    <span class="op">&lt;</span><span class="cls">ee:transform</span> doc:name=<span class="str">"Map to ERP format"</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">ee:message</span><span class="op">&gt;&lt;</span><span class="cls">ee:set-payload</span><span class="op">&gt;</span>
        %dw 2.0
        output application/json
        ---
        { orderId: payload.Order_Id__c, amount: payload.Amount__c }
      <span class="op">&lt;/</span><span class="cls">ee:set-payload</span><span class="op">&gt;&lt;/</span><span class="cls">ee:message</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">ee:transform</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">http:request</span> method=<span class="str">"POST"</span> url=<span class="str">"${erp.endpoint}/orders"</span> /&gt;
  <span class="op">&lt;/</span><span class="cls">flow</span><span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">salesforce:subscribe-topic-listener</span><span class="op">&gt;</span></pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">MuleSoft Integration — Best Practices</span>
            <span class="code-tag tag-info">Architecture</span>
          </div>
          <pre><span class="cmt">// ── 1. Always use External IDs for upsert — avoids SOQL in Mule ──
// Mark Integration_Id__c as externalId=true in field metadata

// ── 2. Use Bulk API 2.0 for large data volumes ──
// Mule's salesforce:bulk-operation auto-batches into 10k-row chunks:
//   salesforce:bulk-insert-v2 / salesforce:bulk-upsert-v2

// ── 3. Handle partial success from Bulk API ──
// Bulk API returns per-record success/failure
// Always process salesforce:failed-records for retry logic

// ── 4. JWT Bearer Token flow (no user interaction, server-to-server) ──
// Steps:
// a) Create Connected App with "Use digital signatures"
// b) Upload server certificate to Connected App
// c) Grant "Admin approved users are pre-authorized" OAuth policy
// d) Pre-authorize your integration user in Connected App settings

// ── 5. Idempotency — always design for replay ──
// Mule may replay events on failure. Your Apex endpoint must be
// idempotent: upsert by External ID, not insert-then-update.</pre>
        </div>
      </div>

      <!-- REST / SOAP TAB -->
      <div class="tab-content" id="tab-rest">
        <div class="int-diagram">
          <div class="int-node ext">3RD PARTY<br><div class="int-node-label">Any System</div></div>
          <div class="int-arrow bi">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">REST API<br>JSON/XML</div>
          </div>
          <div class="int-node sf">SALESFORCE<br><div class="int-node-label">REST API v62.0</div></div>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Inbound: Custom REST Endpoint (@RestResource)</span>
            <span class="code-tag tag-apex">Apex</span>
          </div>
          <pre><span class="ann">@RestResource</span>(urlMapping=<span class="str">'/v1/accounts/*'</span>)
<span class="kw">global with sharing class</span> <span class="cls">AccountRestService</span> {

    <span class="ann">@HttpGet</span>
    <span class="kw">global static</span> <span class="cls">AccountResponse</span> <span class="met">getAccount</span>() {
        <span class="cls">RestRequest</span> req = RestContext.request;
        String extId = req.requestURI.<span class="met">substringAfterLast</span>(<span class="str">'/'</span>);

        <span class="kw">try</span> {
            Account acc = [
                <span class="kw">SELECT</span> Id, Name, AnnualRevenue, BillingCity
                <span class="kw">FROM</span> Account
                <span class="kw">WHERE</span> Integration_Id__c = :extId
                <span class="kw">LIMIT</span> 1
            ];
            RestContext.response.statusCode = <span class="num">200</span>;
            <span class="kw">return new</span> <span class="cls">AccountResponse</span>(<span class="kw">true</span>, acc, <span class="kw">null</span>);
        } <span class="kw">catch</span> (<span class="cls">QueryException</span> e) {
            RestContext.response.statusCode = <span class="num">404</span>;
            <span class="kw">return new</span> <span class="cls">AccountResponse</span>(<span class="kw">false</span>, <span class="kw">null</span>, <span class="str">'Not found: '</span> + extId);
        }
    }

    <span class="ann">@HttpPost</span>
    <span class="kw">global static</span> <span class="cls">AccountResponse</span> <span class="met">upsertAccount</span>() {
        <span class="cls">RestRequest</span> req = RestContext.request;
        <span class="cmt">// Deserialize strongly typed — never parse JSON manually</span>
        <span class="cls">AccountPayload</span> payload = (<span class="cls">AccountPayload</span>)
            JSON.<span class="met">deserialize</span>(req.requestBody.<span class="met">toString</span>(), <span class="cls">AccountPayload</span>.<span class="kw">class</span>);

        Account acc = <span class="kw">new</span> <span class="cls">Account</span>(
            Name = payload.name,
            Integration_Id__c = payload.externalId,
            AnnualRevenue = payload.revenue
        );

        Database.<span class="cls">UpsertResult</span> result =
            Database.<span class="met">upsert</span>(acc, <span class="cls">Account</span>.Integration_Id__c, <span class="kw">false</span>);

        RestContext.response.statusCode = result.isCreated() ? <span class="num">201</span> : <span class="num">200</span>;
        <span class="kw">return new</span> <span class="cls">AccountResponse</span>(result.isSuccess(), acc, <span class="kw">null</span>);
    }

    <span class="kw">global class</span> <span class="cls">AccountPayload</span> {
        <span class="kw">public</span> String name, externalId;
        <span class="kw">public</span> Decimal revenue;
    }
    <span class="kw">global class</span> <span class="cls">AccountResponse</span> {
        <span class="kw">public</span> Boolean success;
        <span class="kw">public</span> Account record;
        <span class="kw">public</span> String error;
        <span class="kw">public</span> <span class="cls">AccountResponse</span>(Boolean s, Account r, String e) {
            this.success=s; this.record=r; this.error=e;
        }
    }
}</pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Outbound: Apex HTTP Callout with Named Credential</span>
            <span class="code-tag tag-apex">Apex</span>
          </div>
          <pre><span class="kw">public class</span> <span class="cls">ErpIntegrationService</span> {

    <span class="cmt">// Named Credential handles auth — no secrets in code</span>
    <span class="kw">private static final</span> String ENDPOINT =
        <span class="str">'callout:ERP_API/api/v2/orders'</span>;

    <span class="ann">@future(callout=true)</span>  <span class="cmt">// Required if called from trigger</span>
    <span class="kw">public static void</span> <span class="met">syncOrderAsync</span>(String orderId) {
        <span class="cls">Order__c</span> ord = [
            <span class="kw">SELECT</span> Id, Name, Total__c, Status__c
            <span class="kw">FROM</span> Order__c <span class="kw">WHERE</span> Id = :orderId
        ];

        HttpRequest req = <span class="kw">new</span> <span class="cls">HttpRequest</span>();
        req.<span class="met">setEndpoint</span>(ENDPOINT);
        req.<span class="met">setMethod</span>(<span class="str">'POST'</span>);
        req.<span class="met">setHeader</span>(<span class="str">'Content-Type'</span>, <span class="str">'application/json'</span>);
        req.<span class="met">setHeader</span>(<span class="str">'X-Idempotency-Key'</span>, ord.Id);  <span class="cmt">// Prevent duplicates</span>
        req.<span class="met">setTimeout</span>(<span class="num">30000</span>);  <span class="cmt">// 30s — always set explicit timeout</span>

        Map&lt;String, Object&gt; body = <span class="kw">new</span> Map&lt;String, Object&gt;{
            <span class="str">'sfId'</span>    => ord.Id,
            <span class="str">'name'</span>    => ord.Name,
            <span class="str">'total'</span>   => ord.Total__c,
            <span class="str">'status'</span>  => ord.Status__c
        };
        req.<span class="met">setBody</span>(JSON.<span class="met">serialize</span>(body));

        HttpResponse res = <span class="kw">new</span> Http().<span class="met">send</span>(req);

        <span class="kw">if</span> (res.<span class="met">getStatusCode</span>() == <span class="num">200</span> || res.<span class="met">getStatusCode</span>() == <span class="num">201</span>) {
            Map&lt;String, Object&gt; resp =
                (Map&lt;String, Object&gt;) JSON.<span class="met">deserializeUntyped</span>(res.<span class="met">getBody</span>());
            ord.ERP_Order_Id__c = (String) resp.<span class="met">get</span>(<span class="str">'erpId'</span>);
            <span class="met">update</span> ord;
        } <span class="kw">else</span> {
            <span class="cmt">// Log to custom Error_Log__c object for monitoring</span>
            <span class="cls">ErrorLogger</span>.<span class="met">log</span>(<span class="str">'ERP Sync'</span>, res.<span class="met">getStatus</span>(), res.<span class="met">getBody</span>(), orderId);
        }
    }
}</pre>
        </div>
      </div>

      <!-- PLATFORM EVENTS TAB -->
      <div class="tab-content" id="tab-events">
        <div class="int-diagram">
          <div class="int-node sf">SALESFORCE<br><div class="int-node-label">Publisher</div></div>
          <div class="int-arrow">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Platform Event<br>Order_Created__e</div>
          </div>
          <div class="int-node heroku">EVENT BUS<br><div class="int-node-label">Pub/Sub API (gRPC)</div></div>
          <div class="int-arrow">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Subscribe<br>Any language</div>
          </div>
          <div class="int-node ext">CONSUMERS<br><div class="int-node-label">MuleSoft · Node · Python</div></div>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Publish Platform Event from Apex</span>
            <span class="code-tag tag-apex">Apex</span>
          </div>
          <pre><span class="cmt">// Platform Events: decoupled, reliable, cross-system messaging
// EventBus.publish() does NOT consume DML statement limits
// Events are committed only if transaction succeeds</span>

<span class="kw">public class</span> <span class="cls">OrderEventService</span> {

    <span class="kw">public static void</span> <span class="met">publishOrderCreated</span>(List&lt;<span class="cls">Order__c</span>&gt; orders) {
        List&lt;<span class="cls">Order_Created__e</span>&gt; events = <span class="kw">new</span> List&lt;<span class="cls">Order_Created__e</span>&gt;();
        <span class="kw">for</span> (<span class="cls">Order__c</span> ord : orders) {
            events.<span class="met">add</span>(<span class="kw">new</span> <span class="cls">Order_Created__e</span>(
                Order_Id__c     = ord.Id,
                Account_Id__c   = ord.AccountId,
                Total_Amount__c = ord.Total__c,
                Currency__c     = ord.CurrencyIsoCode,
                Created_By__c   = UserInfo.<span class="met">getUserId</span>()
            ));
        }

        List&lt;<span class="cls">Database.SaveResult</span>&gt; results =
            EventBus.<span class="met">publish</span>(events);

        <span class="kw">for</span> (Integer i = <span class="num">0</span>; i &lt; results.<span class="met">size</span>(); i++) {
            <span class="kw">if</span> (!results[i].isSuccess()) {
                System.<span class="met">debug</span>(<span class="str">'Event publish failed: '</span> +
                    results[i].getErrors()[<span class="num">0</span>].getMessage());
            }
        }
    }

    <span class="cmt">// Subscribe in Apex trigger on the Platform Event object</span>
    <span class="cmt">// trigger OrderCreatedTrigger on Order_Created__e (after insert) {</span>
    <span class="cmt">//     for (Order_Created__e evt : Trigger.new) {</span>
    <span class="cmt">//         ErpIntegrationService.syncOrderAsync(evt.Order_Id__c);</span>
    <span class="cmt">//     }                                                            }</span>
}</pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Subscribe via Pub/Sub API (Python gRPC client)</span>
            <span class="code-tag tag-info">Python</span>
          </div>
          <pre><span class="cmt"># Salesforce Pub/Sub API — real-time event stream via gRPC
# pip install salesforce-pubsub-client grpcio</span>

<span class="kw">import</span> grpc
<span class="kw">from</span> pubsub_api_pb2_grpc <span class="kw">import</span> PubSubStub
<span class="kw">from</span> pubsub_api_pb2 <span class="kw">import</span> FetchRequest

<span class="kw">def</span> <span class="met">subscribe_to_orders</span>(access_token: str, instance_url: str):
    channel = grpc.<span class="met">secure_channel</span>(
        <span class="str">'api.pubsub.salesforce.com:7443'</span>,
        grpc.<span class="met">ssl_channel_credentials</span>()
    )
    stub = <span class="cls">PubSubStub</span>(channel)

    <span class="kw">def</span> <span class="met">fetch_req_stream</span>():
        <span class="kw">yield</span> <span class="cls">FetchRequest</span>(
            topic_name=<span class="str">'/event/Order_Created__e'</span>,
            replay_preset=<span class="num">2</span>,         <span class="cmt"># LATEST = 2, EARLIEST = 0</span>
            num_requested=<span class="num">100</span>
        )

    metadata = [
        (<span class="str">'accesstoken'</span>, access_token),
        (<span class="str">'instanceurl'</span>, instance_url),
        (<span class="str">'tenantid'</span>, <span class="str">'your-org-id'</span>)
    ]

    <span class="kw">for</span> event <span class="kw">in</span> stub.<span class="met">Subscribe</span>(<span class="met">fetch_req_stream</span>(), metadata=metadata):
        <span class="cmt"># Decode Avro-encoded payload</span>
        decoded = avro.<span class="met">decode</span>(event.events[<span class="num">0</span>].event.payload)
        print(<span class="str">f"Order received: {decoded['Order_Id__c']}"</span>)
        <span class="cmt"># Route to ERP, warehouse, etc.</span>
        route_to_erp(decoded)</pre>
        </div>
      </div>

      <!-- ETL / 3RD PARTY TAB -->
      <div class="tab-content" id="tab-etl">
        <div class="int-diagram">
          <div class="int-node ext">DATA SOURCE<br><div class="int-node-label">DB · S3 · SaaS API</div></div>
          <div class="int-arrow">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Extract<br>Transform</div>
          </div>
          <div class="int-node kafka">MIDDLEWARE<br><div class="int-node-label">Informatica · Boomi · Fivetran</div></div>
          <div class="int-arrow">
            <div class="int-arrow-line"></div>
            <div class="int-arrow-label">Bulk API 2.0<br>Upsert by Ext ID</div>
          </div>
          <div class="int-node sf">SALESFORCE<br><div class="int-node-label">Load Target</div></div>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">Bulk API 2.0 — Direct HTTP (Python)</span>
            <span class="code-tag tag-info">Python</span>
          </div>
          <pre><span class="kw">import</span> requests, time

<span class="kw">class</span> <span class="cls">BulkAPIClient</span>:
    <span class="kw">def</span> <span class="met">__init__</span>(self, instance_url: str, access_token: str):
        self.base = <span class="str">f"{instance_url}/services/data/v62.0/jobs/ingest"</span>
        self.headers = {
            <span class="str">'Authorization'</span>: <span class="str">f'Bearer {access_token}'</span>,
            <span class="str">'Content-Type'</span>: <span class="str">'application/json'</span>
        }

    <span class="kw">def</span> <span class="met">upsert_records</span>(self, obj: str, ext_id_field: str, csv_data: str):
        <span class="cmt"># 1. Create Bulk Job</span>
        job = requests.<span class="met">post</span>(self.base, json={
            <span class="str">'object'</span>: obj,
            <span class="str">'operation'</span>: <span class="str">'upsert'</span>,
            <span class="str">'externalIdFieldName'</span>: ext_id_field,
            <span class="str">'lineEnding'</span>: <span class="str">'LF'</span>,
            <span class="str">'contentType'</span>: <span class="str">'CSV'</span>
        }, headers=self.headers).<span class="met">json</span>()
        job_id = job[<span class="str">'id'</span>]

        <span class="cmt"># 2. Upload CSV data</span>
        requests.<span class="met">put</span>(
            <span class="str">f"{self.base}/{job_id}/batches"</span>,
            data=csv_data,
            headers={**self.headers, <span class="str">'Content-Type'</span>: <span class="str">'text/csv'</span>}
        )

        <span class="cmt"># 3. Close job to start processing</span>
        requests.<span class="met">patch</span>(<span class="str">f"{self.base}/{job_id}"</span>,
            json={<span class="str">'state'</span>: <span class="str">'UploadComplete'</span>}, headers=self.headers)

        <span class="cmt"># 4. Poll until complete</span>
        <span class="kw">while True</span>:
            status = requests.<span class="met">get</span>(
                <span class="str">f"{self.base}/{job_id}"</span>, headers=self.headers).<span class="met">json</span>()
            <span class="kw">if</span> status[<span class="str">'state'</span>] <span class="kw">in</span> [<span class="str">'JobComplete'</span>, <span class="str">'Failed'</span>, <span class="str">'Aborted'</span>]:
                <span class="kw">break</span>
            time.<span class="met">sleep</span>(<span class="num">5</span>)

        <span class="cmt"># 5. Get failed records for retry</span>
        failed = requests.<span class="met">get</span>(
            <span class="str">f"{self.base}/{job_id}/failedResults"</span>,
            headers={**self.headers, <span class="str">'Accept'</span>: <span class="str">'text/csv'</span>})
        <span class="kw">return</span> {<span class="str">'status'</span>: status, <span class="str">'failed_csv'</span>: failed.text}</pre>
        </div>

        <div class="code-card">
          <div class="code-header">
            <span class="code-label">3rd-Party Integration Checklist</span>
            <span class="code-tag tag-info">Architecture</span>
          </div>
          <pre><span class="cmt">// ── Authentication ──────────────────────────────────────────────
// ✅ Use Connected App + OAuth 2.0 JWT Bearer for server-to-server
// ✅ Store tokens in Named Credentials — never in Custom Settings
// ✅ Rotate certificates annually; use short-lived access tokens
// ✅ Grant minimum required OAuth scopes (api, refresh_token, etc.)

// ── Data Sync Strategy ──────────────────────────────────────────
// ✅ Always upsert by External ID — never query-then-insert
// ✅ External ID fields: set externalId=true + unique=true in metadata
// ✅ Use Bulk API 2.0 for > 2,000 records (not REST /sobjects/...)
// ✅ Implement retry with exponential backoff for transient failures

// ── Error Handling & Observability ──────────────────────────────
// ✅ Log all API requests/responses to Integration_Log__c object
// ✅ Use Platform Events to signal failures to monitoring systems
// ✅ Never lose data: failed records → retry queue → dead letter queue
// ✅ Alert on error rate > threshold via flow or Apex Batch

// ── Common 3rd-Party Patterns ───────────────────────────────────
// Informatica Cloud: Use Salesforce V2 connector; enable bulk mode
// Boomi AtomSphere:  Use Dynamic Document Properties for Ext IDs
// Fivetran / Census: Read-only Connected App; SF as sync destination
// Heroku Connect:    Bidirectional DB sync; set "Write to Salesforce"
// MuleSoft Anypoint: Use DataWeave for transform; streaming for events

// ── Rate Limits to Know ─────────────────────────────────────────
// REST API: 1,000 req/user/hour (Enterprise), burst to ~5x
// Bulk API 2.0: 150MB/job, 15,000 batches/day
// Streaming/Events: 200,000 event deliveries/24hr (Enterprise)</pre>
        </div>
      </div>
    </section>

  </main>
</div>

<script>
  function showPanel(id) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.currentTarget.classList.add('active');
  }

  function buildSOQL() {
    const obj = document.getElementById('soql-obj').value;
    const fields = document.getElementById('soql-fields').value.trim() || 'Id, Name';
    const where = document.getElementById('soql-where').value.trim();
    const order = document.getElementById('soql-order').value.trim();
    const limit = document.getElementById('soql-limit').value;
    const mode = document.getElementById('soql-mode').value;

    let soql = `SELECT ${fields}\nFROM ${obj}`;
    if (where) soql += `\nWHERE ${where}`;
    if (order) soql += `\nORDER BY ${order}`;
    if (limit) soql += `\nLIMIT ${limit}`;

    let output = '';
    if (mode === 'list') {
      output = `List<${obj}> results = [\n    ${soql.replace(/\n/g, '\n    ')}\n];`;
    } else if (mode === 'map') {
      output = `Map<Id, ${obj}> resultMap = new Map<Id, ${obj}>([\n    ${soql.replace(/\n/g, '\n    ')}\n]);`;
    } else {
      output = soql;
    }

    document.getElementById('soql-output').textContent = output;
  }

  function copySOQL() {
    const text = document.getElementById('soql-output').textContent;
    if (text && text !== "Click \"Generate Query →\" to build your SOQL") {
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copy-soql-btn');
        btn.textContent = 'COPIED!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'COPY';
          btn.classList.remove('copied');
        }, 2000);
      });
    }
  }

  // Build initial SOQL on load
  buildSOQL();

  function showTab(id, el) {
    const panel = el.closest('.panel');
    panel.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    panel.querySelectorAll('.tab-pill').forEach(t => t.classList.remove('active'));
    document.getElementById('tab-' + id).classList.add('active');
    el.classList.add('active');
  }

  // ── APEX BUILDER ──
  let currentTemplate = 'service';
  let methodCounter = 1;

  function selectTemplate(type, el) {
    currentTemplate = type;
    document.querySelectorAll('.template-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    
    // Show/hide relevant config sections
    document.getElementById('method-config').style.display = type === 'service' || type === 'controller' ? 'block' : 'none';
    document.getElementById('batch-config').style.display = type === 'batch' ? 'block' : 'none';
    document.getElementById('rest-config').style.display = type === 'rest' ? 'block' : 'none';
  }

  function addMethod() {
    methodCounter++;
    const methodList = document.getElementById('method-list');
    const methodItem = document.createElement('div');
    methodItem.className = 'method-item';
    methodItem.innerHTML = `
      <div class="method-sig">public static void processRecords${methodCounter}(List&lt;SObject&gt; records)</div>
      <button class="method-remove" onclick="removeMethod(this)">REMOVE</button>
    `;
    methodList.appendChild(methodItem);
  }

  function removeMethod(btn) {
    btn.parentElement.remove();
  }

  function generateApexClass() {
    const className = document.getElementById('apex-class-name').value || 'MyClass';
    const desc = document.getElementById('apex-class-desc').value || 'Generated Apex class';
    const sharing = document.getElementById('apex-sharing').value;
    const access = document.getElementById('apex-access').value;
    const errorHandling = document.getElementById('feat-error').checked;
    const limitChecks = document.getElementById('feat-limits').checked;
    const logging = document.getElementById('feat-logging').checked;

    let code = '';

    // Header comment
    code += `<span class="cmt">/**\n * ${desc}\n * @author ${new Date().toLocaleDateString()}\n */</span>\n`;

    // Template-specific generation
    if (currentTemplate === 'service') {
      code += generateServiceClass(className, sharing, access, errorHandling, limitChecks, logging);
    } else if (currentTemplate === 'batch') {
      code += generateBatchClass(className, sharing, access, errorHandling, logging);
    } else if (currentTemplate === 'rest') {
      code += generateRestClass(className, errorHandling, logging);
    } else if (currentTemplate === 'queueable') {
      code += generateQueueableClass(className, sharing, access, errorHandling, logging);
    } else if (currentTemplate === 'controller') {
      code += generateControllerClass(className, sharing, access, errorHandling, logging);
    } else if (currentTemplate === 'scheduler') {
      code += generateSchedulerClass(className, errorHandling, logging);
    }

    document.getElementById('apex-output').innerHTML = code;
  }

  function generateServiceClass(className, sharing, access, errorHandling, limitChecks, logging) {
    const methods = Array.from(document.querySelectorAll('#method-list .method-sig')).map(m => m.textContent);
    
    let code = `<span class="ann">${access} ${sharing} class</span> <span class="cls">${className}</span> {\n\n`;
    
    methods.forEach(methodSig => {
      const methodName = methodSig.match(/void (\w+)/)?.[1] || 'processRecords';
      const paramMatch = methodSig.match(/List<(\\w+)>/);
      const objType = paramMatch ? paramMatch[1] : 'SObject';
      
      code += `    <span class="cmt">/**\n     * Process ${objType} records with business logic\n     * @param records List of ${objType} to process\n     */</span>\n`;
      code += `    <span class="ann">${methodSig.replace(/&lt;/g, '<').replace(/&gt;/g, '>')}</span> {\n`;
      
      if (errorHandling) {
        code += `        <span class="kw">try</span> {\n`;
      }
      
      if (limitChecks) {
        code += `            <span class="cmt">// Check governor limits before processing</span>\n`;
        code += `            <span class="kw">if</span> (Limits.getDmlStatements() >= Limits.getLimitDmlStatements() - <span class="num">10</span>) {\n`;
        code += `                <span class="kw">throw new</span> <span class="cls">LimitException</span>(<span class="str">'Approaching DML limit'</span>);\n`;
        code += `            }\n\n`;
      }
      
      if (logging) {
        code += `            System.<span class="met">debug</span>(<span class="str">'Processing '</span> + records.<span class="met">size</span>() + <span class="str">' records'</span>);\n`;
      }
      
      code += `            <span class="cmt">// TODO: Implement business logic here</span>\n`;
      code += `            List<${objType}> toUpdate = <span class="kw">new</span> List<${objType}>();\n`;
      code += `            <span class="kw">for</span> (${objType} record : records) {\n`;
      code += `                <span class="cmt">// Process each record</span>\n`;
      code += `                toUpdate.<span class="met">add</span>(record);\n`;
      code += `            }\n\n`;
      code += `            <span class="kw">if</span> (!toUpdate.<span class="met">isEmpty</span>()) {\n`;
      code += `                <span class="met">update</span> toUpdate;\n`;
      code += `            }\n`;
      
      if (errorHandling) {
        code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
        code += `            System.<span class="met">debug</span>(<span class="cls">LoggingLevel</span>.ERROR, <span class="str">'Error in ${methodName}: '</span> + e.getMessage());\n`;
        code += `            <span class="kw">throw</span> e;\n`;
        code += `        }\n`;
      }
      
      code += `    }\n\n`;
    });
    
    code += `}`;
    return code;
  }

  function generateBatchClass(className, sharing, access, errorHandling, logging) {
    const obj = document.getElementById('batch-object').value;
    const batchSize = document.getElementById('batch-size').value;
    
    let code = `<span class="ann">${access} ${sharing} class</span> <span class="cls">${className}</span> <span class="kw">implements</span> Database.<span class="cls">Batchable</span><&lt;<span class="cls">sObject</span>&gt;>, Database.<span class="cls">Stateful</span> {\n\n`;
    code += `    <span class="kw">private</span> Integer recordsProcessed = <span class="num">0</span>;\n\n`;
    code += `    <span class="ann">public</span> Database.<span class="cls">QueryLocator</span> <span class="met">start</span>(Database.<span class="cls">BatchableContext</span> bc) {\n`;
    if (logging) code += `        System.<span class="met">debug</span>(<span class="str">'Batch starting'</span>);\n`;
    code += `        <span class="kw">return</span> Database.<span class="met">getQueryLocator</span>([\n`;
    code += `            <span class="kw">SELECT</span> Id, Name <span class="kw">FROM</span> ${obj}\n`;
    code += `            <span class="kw">WHERE</span> CreatedDate = TODAY\n`;
    code += `        ]);\n`;
    code += `    }\n\n`;
    code += `    <span class="ann">public void</span> <span class="met">execute</span>(Database.<span class="cls">BatchableContext</span> bc, List&lt;<span class="cls">${obj}</span>&gt; scope) {\n`;
    if (errorHandling) code += `        <span class="kw">try</span> {\n`;
    if (logging) code += `            System.<span class="met">debug</span>(<span class="str">'Processing batch of '</span> + scope.<span class="met">size</span>() + <span class="str">' records'</span>);\n`;
    code += `            <span class="cmt">// TODO: Process records in scope</span>\n`;
    code += `            recordsProcessed += scope.<span class="met">size</span>();\n`;
    if (errorHandling) {
      code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
      code += `            System.<span class="met">debug</span>(<span class="cls">LoggingLevel</span>.ERROR, <span class="str">'Batch error: '</span> + e.getMessage());\n`;
      code += `        }\n`;
    }
    code += `    }\n\n`;
    code += `    <span class="ann">public void</span> <span class="met">finish</span>(Database.<span class="cls">BatchableContext</span> bc) {\n`;
    if (logging) code += `        System.<span class="met">debug</span>(<span class="str">'Batch complete. Processed: '</span> + recordsProcessed);\n`;
    code += `        <span class="cmt">// TODO: Send notification, chain another batch, etc.</span>\n`;
    code += `    }\n`;
    code += `}\n\n`;
    code += `<span class="cmt">// Execute: Database.executeBatch(new ${className}(), ${batchSize});</span>`;
    return code;
  }

  function generateRestClass(className, errorHandling, logging) {
    const urlMapping = document.getElementById('rest-url').value;
    const hasGet = document.getElementById('http-get').checked;
    const hasPost = document.getElementById('http-post').checked;
    const hasPatch = document.getElementById('http-patch').checked;
    const hasDelete = document.getElementById('http-delete').checked;
    
    let code = `<span class="ann">@RestResource</span>(urlMapping=<span class="str">'${urlMapping}'</span>)\n`;
    code += `<span class="ann">global with sharing class</span> <span class="cls">${className}</span> {\n\n`;
    
    if (hasGet) {
      code += `    <span class="ann">@HttpGet</span>\n`;
      code += `    <span class="ann">global static</span> <span class="cls">Response</span> <span class="met">doGet</span>() {\n`;
      if (errorHandling) code += `        <span class="kw">try</span> {\n`;
      code += `            <span class="cls">RestRequest</span> req = RestContext.request;\n`;
      code += `            String recordId = req.requestURI.<span class="met">substringAfterLast</span>(<span class="str">'/'</span>);\n`;
      if (logging) code += `            System.<span class="met">debug</span>(<span class="str">'GET request for: '</span> + recordId);\n`;
      code += `            <span class="cmt">// TODO: Query and return data</span>\n`;
      code += `            RestContext.response.statusCode = <span class="num">200</span>;\n`;
      code += `            <span class="kw">return new</span> <span class="cls">Response</span>(<span class="kw">true</span>, <span class="str">'Success'</span>, <span class="kw">null</span>);\n`;
      if (errorHandling) {
        code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
        code += `            RestContext.response.statusCode = <span class="num">500</span>;\n`;
        code += `            <span class="kw">return new</span> <span class="cls">Response</span>(<span class="kw">false</span>, <span class="kw">null</span>, e.getMessage());\n`;
        code += `        }\n`;
      }
      code += `    }\n\n`;
    }
    
    if (hasPost) {
      code += `    <span class="ann">@HttpPost</span>\n`;
      code += `    <span class="ann">global static</span> <span class="cls">Response</span> <span class="met">doPost</span>() {\n`;
      if (errorHandling) code += `        <span class="kw">try</span> {\n`;
      code += `            <span class="cls">RestRequest</span> req = RestContext.request;\n`;
      code += `            <span class="cmt">// TODO: Deserialize payload and create record</span>\n`;
      code += `            RestContext.response.statusCode = <span class="num">201</span>;\n`;
      code += `            <span class="kw">return new</span> <span class="cls">Response</span>(<span class="kw">true</span>, <span class="str">'Created'</span>, <span class="kw">null</span>);\n`;
      if (errorHandling) {
        code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
        code += `            RestContext.response.statusCode = <span class="num">500</span>;\n`;
        code += `            <span class="kw">return new</span> <span class="cls">Response</span>(<span class="kw">false</span>, <span class="kw">null</span>, e.getMessage());\n`;
        code += `        }\n`;
      }
      code += `    }\n\n`;
    }
    
    code += `    <span class="ann">global class</span> <span class="cls">Response</span> {\n`;
    code += `        <span class="ann">global</span> Boolean success;\n`;
    code += `        <span class="ann">global</span> String data;\n`;
    code += `        <span class="ann">global</span> String error;\n`;
    code += `        <span class="ann">global</span> <span class="cls">Response</span>(Boolean s, String d, String e) {\n`;
    code += `            this.success = s; this.data = d; this.error = e;\n`;
    code += `        }\n`;
    code += `    }\n`;
    code += `}`;
    return code;
  }

  function generateQueueableClass(className, sharing, access, errorHandling, logging) {
    let code = `<span class="ann">${access} ${sharing} class</span> <span class="cls">${className}</span> <span class="kw">implements</span> Queueable {\n\n`;
    code += `    <span class="kw">private</span> List&lt;Id&gt; recordIds;\n\n`;
    code += `    <span class="ann">public</span> <span class="cls">${className}</span>(List&lt;Id&gt; ids) {\n`;
    code += `        this.recordIds = ids;\n`;
    code += `    }\n\n`;
    code += `    <span class="ann">public void</span> <span class="met">execute</span>(QueueableContext context) {\n`;
    if (errorHandling) code += `        <span class="kw">try</span> {\n`;
    if (logging) code += `            System.<span class="met">debug</span>(<span class="str">'Queueable processing '</span> + recordIds.<span class="met">size</span>() + <span class="str">' records'</span>);\n`;
    code += `            <span class="cmt">// TODO: Implement async logic here</span>\n\n`;
    code += `            <span class="cmt">// Optional: Chain another queueable</span>\n`;
    code += `            <span class="cmt">// System.enqueueJob(new AnotherQueueable());</span>\n`;
    if (errorHandling) {
      code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
      code += `            System.<span class="met">debug</span>(<span class="cls">LoggingLevel</span>.ERROR, <span class="str">'Queueable error: '</span> + e.getMessage());\n`;
      code += `        }\n`;
    }
    code += `    }\n`;
    code += `}\n\n`;
    code += `<span class="cmt">// Execute: System.enqueueJob(new ${className}(recordIdList));</span>`;
    return code;
  }

  function generateControllerClass(className, sharing, access, errorHandling, logging) {
    let code = `<span class="ann">${access} ${sharing} class</span> <span class="cls">${className}</span> {\n\n`;
    code += `    <span class="ann">@AuraEnabled(cacheable=true)</span>\n`;
    code += `    <span class="ann">public static</span> List&lt;Account&gt; <span class="met">getAccounts</span>() {\n`;
    if (errorHandling) code += `        <span class="kw">try</span> {\n`;
    code += `            <span class="kw">return</span> [<span class="kw">SELECT</span> Id, Name <span class="kw">FROM</span> Account <span class="kw">LIMIT</span> <span class="num">10</span>];\n`;
    if (errorHandling) {
      code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
      code += `            <span class="kw">throw new</span> <span class="cls">AuraHandledException</span>(e.getMessage());\n`;
      code += `        }\n`;
    }
    code += `    }\n\n`;
    code += `    <span class="ann">@AuraEnabled</span>\n`;
    code += `    <span class="ann">public static</span> String <span class="met">updateRecord</span>(Id recordId, String newValue) {\n`;
    if (errorHandling) code += `        <span class="kw">try</span> {\n`;
    code += `            <span class="cmt">// TODO: Update logic</span>\n`;
    code += `            <span class="kw">return</span> <span class="str">'Success'</span>;\n`;
    if (errorHandling) {
      code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
      code += `            <span class="kw">throw new</span> <span class="cls">AuraHandledException</span>(e.getMessage());\n`;
      code += `        }\n`;
    }
    code += `    }\n`;
    code += `}`;
    return code;
  }

  function generateSchedulerClass(className, errorHandling, logging) {
    let code = `<span class="ann">public class</span> <span class="cls">${className}</span> <span class="kw">implements</span> Schedulable {\n\n`;
    code += `    <span class="ann">public void</span> <span class="met">execute</span>(SchedulableContext sc) {\n`;
    if (errorHandling) code += `        <span class="kw">try</span> {\n`;
    if (logging) code += `            System.<span class="met">debug</span>(<span class="str">'Scheduled job running'</span>);\n`;
    code += `            <span class="cmt">// TODO: Implement scheduled logic</span>\n`;
    code += `            <span class="cmt">// Typically executes a batch or queueable</span>\n`;
    code += `            Database.<span class="met">executeBatch</span>(<span class="kw">new</span> <span class="cls">MyBatchClass</span>(), <span class="num">200</span>);\n`;
    if (errorHandling) {
      code += `        } <span class="kw">catch</span> (<span class="cls">Exception</span> e) {\n`;
      code += `            System.<span class="met">debug</span>(<span class="cls">LoggingLevel</span>.ERROR, <span class="str">'Scheduler error: '</span> + e.getMessage());\n`;
      code += `        }\n`;
    }
    code += `    }\n`;
    code += `}\n\n`;
    code += `<span class="cmt">// Schedule: System.schedule('Job Name', '0 0 2 * * ?', new ${className}());</span>\n`;
    code += `<span class="cmt">// Cron: '0 0 2 * * ?' = Daily at 2:00 AM</span>`;
    return code;
  }

  function copyApexCode() {
    const output = document.getElementById('apex-output');
    const text = output.innerText || output.textContent;
    if (text && !text.includes('Click "Generate')) {
      navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById('copy-apex-btn');
        btn.textContent = 'COPIED!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'COPY';
          btn.classList.remove('copied');
        }, 2000);
      });
    }
  }

  // ── MULESOFT HANDBOOK: Toggle solutions ──
  function toggleSolution(tabEl, solutionId) {
    const card = tabEl.closest('.edge-case-card');
    card.querySelectorAll('.solution-tab').forEach(t => t.classList.remove('active'));
    card.querySelectorAll('.solution-content').forEach(c => c.classList.remove('active'));
    tabEl.classList.add('active');
    card.querySelector(`[data-solution="${solutionId}"]`).classList.add('active');
  }
</script>
</body>
</html>
