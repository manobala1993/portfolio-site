<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MuleSoft Handbook - SF Dev Toolkit</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Unbounded:wght@300;700;900&display=swap" rel="stylesheet">
<style>

  :root {
    --sf-blue: #00A1E0;
    --sf-cloud: #032D60;
    --sf-lightning: #FFB75D;
    --sf-green: #04844B;
    --sf-red: #C23934;
    --sf-purple: #7B5EA7;
    --bg: #050E1A;
    --surface: #0A1929;
    --surface2: #0D2137;
    --border: rgba(0,161,224,0.18);
    --text: #E8F4FD;
    --muted: #7BA6BF;
    --mono: 'Space Mono', monospace;
    --display: 'Unbounded', sans-serif;
  }

  /* LIGHT THEME */
  body.light-theme {
    --bg: #F8FAFB;
    --surface: #FFFFFF;
    --surface2: #F3F6F8;
    --border: rgba(0,161,224,0.2);
    --text: #0A1929;
    --muted: #4A6D84;
  }

  body.light-theme {
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,161,224,0.08) 0%, transparent 60%),
      repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,161,224,0.03) 40px),
      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,161,224,0.03) 40px);
  }

  /* THEME TOGGLE BUTTON */
  .theme-toggle {
    background: rgba(0,161,224,0.1);
    border: 1px solid var(--border);
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-left: auto;
    margin-right: 16px;
  }
  .theme-toggle:hover {
    background: rgba(0,161,224,0.2);
    border-color: var(--sf-blue);
    transform: rotate(180deg);
  }
  .theme-icon {
    font-size: 18px;
    transition: transform 0.3s ease;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--mono);
    font-size: 13px;
    min-height: 100vh;
    overflow-x: hidden;
    background-image:
      radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0,161,224,0.12) 0%, transparent 60%),
      repeating-linear-gradient(0deg, transparent, transparent 39px, rgba(0,161,224,0.04) 40px),
      repeating-linear-gradient(90deg, transparent, transparent 39px, rgba(0,161,224,0.04) 40px);
  }

  /* HEADER */
  .header {
    border-bottom: 1px solid var(--border);
    padding: 20px 32px;
    display: flex;
    align-items: center;
    gap: 16px;
    background: rgba(5,14,26,0.9);
    backdrop-filter: blur(12px);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .logo-ring {
    width: 38px; height: 38px;
    border: 2px solid var(--sf-blue);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    animation: pulse-ring 3s ease-in-out infinite;
    flex-shrink: 0;
  }

  @keyframes pulse-ring {
    0%, 100% { box-shadow: 0 0 0 0 rgba(0,161,224,0.4); }
    50% { box-shadow: 0 0 0 8px rgba(0,161,224,0); }
  }

  .header-title {
    font-family: var(--display);
    font-weight: 900;
    font-size: 15px;
    letter-spacing: 0.08em;
    color: var(--sf-blue);
  }
  .header-sub { color: var(--muted); font-size: 10px; letter-spacing: 0.12em; text-transform: uppercase; }

  .version-badge {
    margin-left: auto;
    background: rgba(0,161,224,0.1);
    border: 1px solid var(--border);
    color: var(--sf-blue);
    font-size: 9px;
    letter-spacing: 0.15em;
    padding: 4px 10px;
    border-radius: 2px;
    text-transform: uppercase;
  }

  /* MAIN LAYOUT */
  .layout { display: grid; grid-template-columns: 220px 1fr; min-height: calc(100vh - 70px); }

  /* SIDEBAR */
  .sidebar {
    border-right: 1px solid var(--border);
    padding: 24px 0;
    background: rgba(10,25,41,0.7);
    backdrop-filter: blur(8px);
    position: sticky;
    top: 70px;
    height: calc(100vh - 70px);
    overflow-y: auto;
  }

  .sidebar-section {
    padding: 6px 16px 2px;
    font-size: 9px;
    letter-spacing: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
    margin-top: 16px;
  }
  .sidebar-section:first-child { margin-top: 0; }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    cursor: pointer;
    color: var(--muted);
    font-size: 12px;
    transition: all 0.15s;
    border-left: 2px solid transparent;
    letter-spacing: 0.02em;
  }
  .nav-item:hover { color: var(--text); background: rgba(0,161,224,0.06); }
  .nav-item.active {
    color: var(--sf-blue);
    border-left-color: var(--sf-blue);
    background: rgba(0,161,224,0.1);
  }
  .nav-dot { width: 6px; height: 6px; border-radius: 50%; background: currentColor; flex-shrink: 0; }

  /* CONTENT */
  .content { padding: 36px 40px; max-width: 960px; }

  .panel { display: none; animation: fadeIn 0.3s ease; }
  .panel.active { display: block; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

  .panel-header {
    margin-bottom: 32px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
  }

  .panel-eyebrow {
    font-size: 9px;
    letter-spacing: 0.25em;
    color: var(--sf-blue);
    text-transform: uppercase;
    margin-bottom: 8px;
  }

  .panel-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 24px;
    color: var(--text);
    line-height: 1.2;
  }
  .panel-desc { color: var(--muted); margin-top: 10px; line-height: 1.7; font-size: 12px; }

  /* CODE BLOCKS */
  .code-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 24px;
    overflow: hidden;
  }

  .code-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 16px;
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }

  .code-label {
    font-size: 10px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--sf-blue);
    font-family: var(--display);
    font-weight: 700;
  }

  .code-tag {
    font-size: 9px;
    padding: 2px 8px;
    border-radius: 2px;
    letter-spacing: 0.1em;
  }
  .tag-apex { background: rgba(0,161,224,0.15); color: var(--sf-blue); border: 1px solid rgba(0,161,224,0.3); }
  .tag-soql { background: rgba(4,132,75,0.15); color: #06D670; border: 1px solid rgba(4,132,75,0.3); }
  .tag-lwc { background: rgba(255,183,93,0.15); color: var(--sf-lightning); border: 1px solid rgba(255,183,93,0.3); }
  .tag-warn { background: rgba(194,57,52,0.15); color: #FF6B6B; border: 1px solid rgba(194,57,52,0.3); }
  .tag-good { background: rgba(4,132,75,0.15); color: #06D670; border: 1px solid rgba(4,132,75,0.3); }
  .tag-info { background: rgba(123,94,167,0.15); color: #B89DDF; border: 1px solid rgba(123,94,167,0.3); }

  pre {
    padding: 20px;
    overflow-x: auto;
    line-height: 1.75;
    font-size: 12px;
    font-family: var(--mono);
  }

  .kw { color: #7FD1FF; }
  .str { color: #A8FF78; }
  .num { color: var(--sf-lightning); }
  .cmt { color: #4A6D84; font-style: italic; }
  .cls { color: #FFB3E6; }
  .met { color: #79D9F8; }
  .ann { color: #B89DDF; }
  .op { color: var(--muted); }

  /* GOVERNOR LIMITS TABLE */
  .limits-grid {
    display: grid;
    gap: 12px;
    margin-bottom: 24px;
  }

  .limit-row {
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 16px;
    padding: 14px 18px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    transition: border-color 0.2s;
  }
  .limit-row:hover { border-color: rgba(0,161,224,0.4); }

  .limit-name { font-size: 12px; color: var(--text); }
  .limit-desc { font-size: 10px; color: var(--muted); margin-top: 2px; }

  .limit-val {
    font-family: var(--display);
    font-weight: 700;
    font-size: 15px;
    text-align: right;
    white-space: nowrap;
  }
  .limit-bar-wrap { width: 80px; height: 4px; background: rgba(255,255,255,0.06); border-radius: 2px; }
  .limit-bar { height: 100%; border-radius: 2px; }

  /* PATTERN CARDS */
  .pattern-grid { display: grid; gap: 20px; }

  .pattern-card {
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    background: var(--surface);
    transition: border-color 0.2s, transform 0.2s;
  }
  .pattern-card:hover { border-color: rgba(0,161,224,0.4); transform: translateY(-2px); }

  .pattern-top {
    padding: 16px 20px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
  }

  .pattern-name { font-family: var(--display); font-weight: 700; font-size: 14px; color: var(--text); }
  .pattern-why { font-size: 11px; color: var(--muted); margin-top: 4px; line-height: 1.6; }

  /* CHECKLIST */
  .checklist { list-style: none; display: grid; gap: 8px; }
  .check-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    font-size: 12px;
    line-height: 1.6;
  }
  .check-icon { flex-shrink: 0; margin-top: 1px; }
  .check-icon.pass { color: #06D670; }
  .check-icon.warn { color: var(--sf-lightning); }
  .check-icon.fail { color: #FF6B6B; }

  /* SEARCH BAR */
  .search-wrap {
    position: relative;
    margin-bottom: 24px;
  }
  .search-input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 12px 16px 12px 40px;
    border-radius: 4px;
    outline: none;
    transition: border-color 0.2s;
    letter-spacing: 0.05em;
  }
  .search-input:focus { border-color: var(--sf-blue); }
  .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--muted); font-size: 14px; }

  /* SOQL BUILDER */
  .soql-builder {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 24px;
    margin-bottom: 24px;
  }

  .soql-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }

  .field-group { display: flex; flex-direction: column; gap: 6px; }
  .field-label { font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); }
  .field-select, .field-input {
    background: var(--bg);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: var(--mono);
    font-size: 12px;
    padding: 9px 12px;
    border-radius: 3px;
    outline: none;
    transition: border-color 0.2s;
    width: 100%;
  }
  .field-select:focus, .field-input:focus { border-color: var(--sf-blue); }
  .field-select option { background: var(--bg); }

  .soql-output {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 3px;
    padding: 16px;
    font-size: 12px;
    color: var(--sf-blue);
    letter-spacing: 0.05em;
    min-height: 48px;
    transition: all 0.3s;
    word-break: break-all;
  }

  .gen-btn {
    margin-top: 16px;
    background: var(--sf-blue);
    color: var(--bg);
    border: none;
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 11px 24px;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .gen-btn:hover { background: #30B8F0; transform: translateY(-1px); }

  /* TRIGGER FRAMEWORK */
  .copy-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    font-family: var(--mono);
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.1em;
  }
  .copy-btn:hover { border-color: var(--sf-blue); color: var(--sf-blue); }
  .copy-btn.copied { border-color: #06D670; color: #06D670; }

  /* STATUS INDICATOR */
  .status-strip {
    display: flex;
    gap: 24px;
    padding: 12px 20px;
    background: rgba(0,161,224,0.05);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 28px;
  }
  .status-item { display: flex; align-items: center; gap: 8px; font-size: 11px; color: var(--muted); }
  .status-dot { width: 7px; height: 7px; border-radius: 50%; background: #06D670; box-shadow: 0 0 6px #06D670; animation: blink 2s ease-in-out infinite; }
  @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* INTEGRATION DIAGRAM */
  .int-diagram {
    display: flex;
    align-items: center;
    gap: 0;
    padding: 24px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    margin-bottom: 20px;
    overflow-x: auto;
    flex-wrap: nowrap;
  }
  .int-node {
    flex-shrink: 0;
    min-width: 110px;
    padding: 14px 16px;
    border-radius: 6px;
    text-align: center;
    font-size: 11px;
    font-family: var(--display);
    font-weight: 700;
    letter-spacing: 0.06em;
    border: 1px solid;
  }
  .int-node.sf { background: rgba(0,161,224,0.12); border-color: var(--sf-blue); color: var(--sf-blue); }
  .int-node.mule { background: rgba(0,178,124,0.12); border-color: #00B27C; color: #00B27C; }
  .int-node.ext { background: rgba(255,183,93,0.12); border-color: var(--sf-lightning); color: var(--sf-lightning); }
  .int-node.heroku { background: rgba(123,94,167,0.12); border-color: #7B5EA7; color: #B89DDF; }
  .int-node.kafka { background: rgba(194,57,52,0.12); border-color: var(--sf-red); color: #FF8A8A; }
  .int-node-label { font-size: 9px; font-weight: 400; color: var(--muted); margin-top: 4px; font-family: var(--mono); letter-spacing: 0.1em; }
  .int-arrow {
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0 4px;
    gap: 3px;
    min-width: 60px;
  }
  .int-arrow-line {
    height: 2px;
    width: 100%;
    background: linear-gradient(90deg, var(--border), rgba(0,161,224,0.4), var(--border));
    position: relative;
  }
  .int-arrow-line::after { content: '‚ñ∂'; position: absolute; right: -5px; top: -7px; font-size: 9px; color: var(--muted); }
  .int-arrow-label { font-size: 9px; color: var(--muted); letter-spacing: 0.06em; text-align: center; white-space: nowrap; }
  .int-arrow.bi .int-arrow-line::before { content: '‚óÄ'; position: absolute; left: -5px; top: -7px; font-size: 9px; color: var(--muted); }

  /* TAB PILLS */
  .tab-pills { display: flex; gap: 4px; margin-bottom: 24px; border-bottom: 1px solid var(--border); padding-bottom: 0; }
  .tab-pill {
    padding: 8px 18px;
    font-size: 10px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.15s;
    font-family: var(--display);
    font-weight: 700;
  }
  .tab-pill:hover { color: var(--text); }
  .tab-pill.active { color: var(--sf-blue); border-bottom-color: var(--sf-blue); }
  .tab-content { display: none; }
  .tab-content.active { display: block; animation: fadeIn 0.25s ease; }

  /* FLOW DEBUG STEPS */
  .flow-steps { display: grid; gap: 12px; margin-bottom: 24px; }
  .flow-step {
    display: grid;
    grid-template-columns: 40px 1fr;
    gap: 16px;
    align-items: start;
    padding: 14px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    transition: border-color 0.2s;
  }
  .flow-step:hover { border-color: rgba(0,161,224,0.35); }
  .flow-step-num {
    width: 36px; height: 36px;
    border: 1px solid var(--sf-blue);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--display);
    font-weight: 900;
    font-size: 13px;
    color: var(--sf-blue);
    flex-shrink: 0;
  }
  .flow-step-title { font-family: var(--display); font-weight: 700; font-size: 12px; color: var(--text); margin-bottom: 4px; }
  .flow-step-desc { font-size: 11px; color: var(--muted); line-height: 1.65; }
  .flow-step-tip { margin-top: 8px; padding: 8px 12px; background: rgba(255,183,93,0.08); border-left: 2px solid var(--sf-lightning); font-size: 10px; color: var(--sf-lightning); line-height: 1.6; }

  /* METADATA GRID */
  .meta-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 14px; margin-bottom: 24px; }
  .meta-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 16px;
    transition: border-color 0.2s, transform 0.15s;
  }
  .meta-card:hover { border-color: rgba(0,161,224,0.4); transform: translateY(-2px); }
  .meta-type { font-family: var(--display); font-weight: 700; font-size: 11px; color: var(--sf-blue); margin-bottom: 4px; letter-spacing: 0.05em; }
  .meta-file { font-size: 10px; color: var(--sf-lightning); font-style: italic; margin-bottom: 6px; }
  .meta-desc { font-size: 11px; color: var(--muted); line-height: 1.6; }

  /* DECISION MATRIX */
  .decision-scenario {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 24px;
  }
  .scenario-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .scenario-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
    background: rgba(0,161,224,0.15);
    border: 1px solid var(--sf-blue);
  }
  .scenario-desc {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.65;
    margin-bottom: 16px;
  }

  .decision-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-top: 16px;
  }
  .decision-option {
    background: var(--bg);
    border: 2px solid var(--border);
    border-radius: 6px;
    padding: 16px;
    transition: all 0.2s;
    position: relative;
  }
  .decision-option:hover {
    border-color: rgba(0,161,224,0.4);
    transform: translateY(-2px);
  }
  .decision-option.winner {
    border-color: var(--sf-blue);
    background: rgba(0,161,224,0.06);
  }
  .decision-option.avoid {
    border-color: rgba(194,57,52,0.4);
    opacity: 0.6;
  }
  .option-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }
  .option-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.05em;
  }
  .option-name.flow { color: #FFB75D; }
  .option-name.apex { color: var(--sf-blue); }
  .option-name.mule { color: #00B27C; }
  .verdict-badge {
    font-size: 8px;
    font-weight: 700;
    letter-spacing: 0.15em;
    padding: 3px 8px;
    border-radius: 2px;
    text-transform: uppercase;
    font-family: var(--display);
  }
  .verdict-badge.best {
    background: rgba(0,161,224,0.2);
    color: var(--sf-blue);
    border: 1px solid var(--sf-blue);
  }
  .verdict-badge.ok {
    background: rgba(255,183,93,0.15);
    color: var(--sf-lightning);
    border: 1px solid rgba(255,183,93,0.4);
  }
  .verdict-badge.avoid {
    background: rgba(194,57,52,0.15);
    color: #FF6B6B;
    border: 1px solid rgba(194,57,52,0.4);
  }
  .option-reasons {
    list-style: none;
    display: grid;
    gap: 6px;
  }
  .reason {
    font-size: 10px;
    line-height: 1.5;
    color: var(--muted);
    display: flex;
    align-items: flex-start;
    gap: 8px;
  }
  .reason-icon {
    flex-shrink: 0;
    margin-top: 1px;
    font-size: 10px;
  }
  .reason-icon.pro { color: #06D670; }
  .reason-icon.con { color: #FF6B6B; }

  /* COMPARISON TABLE */
  .compare-table {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 24px;
  }
  .compare-header {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 1px;
    background: var(--border);
  }
  .compare-header-cell {
    background: var(--surface2);
    padding: 12px 16px;
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    text-align: center;
  }
  .compare-header-cell:first-child { text-align: left; }
  .compare-header-cell.flow { color: #FFB75D; }
  .compare-header-cell.apex { color: var(--sf-blue); }
  .compare-header-cell.mule { color: #00B27C; }
  .compare-body {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 1px;
    background: var(--border);
  }
  .compare-row {
    display: contents;
  }
  .compare-cell {
    background: var(--surface);
    padding: 14px 16px;
    font-size: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.5;
  }
  .compare-cell:first-child {
    justify-content: flex-start;
    color: var(--text);
    font-weight: 600;
  }
  .compare-cell.rating-high { color: #06D670; }
  .compare-cell.rating-med { color: var(--sf-lightning); }
  .compare-cell.rating-low { color: #FF6B6B; }

  /* APEX BUILDER */
  .template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  .template-card {
    background: var(--surface);
    border: 2px solid var(--border);
    border-radius: 6px;
    padding: 18px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
  }
  .template-card:hover {
    border-color: var(--sf-blue);
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,161,224,0.15);
  }
  .template-card.selected {
    border-color: var(--sf-blue);
    background: rgba(0,161,224,0.08);
  }
  .template-icon {
    font-size: 28px;
    margin-bottom: 10px;
  }
  .template-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 13px;
    color: var(--text);
    margin-bottom: 6px;
  }
  .template-desc {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.6;
  }
  .template-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    font-size: 8px;
    padding: 3px 8px;
    border-radius: 2px;
    background: rgba(0,161,224,0.15);
    color: var(--sf-blue);
    font-weight: 700;
    letter-spacing: 0.1em;
  }

  .config-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .config-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--sf-blue);
    margin-bottom: 16px;
  }
  .config-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    margin-bottom: 12px;
  }
  .config-row.full {
    grid-template-columns: 1fr;
  }

  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 8px;
  }
  .checkbox-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .checkbox-item input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    accent-color: var(--sf-blue);
  }
  .checkbox-item label {
    font-size: 11px;
    color: var(--text);
    cursor: pointer;
  }

  .method-list {
    display: grid;
    gap: 10px;
    margin-bottom: 16px;
  }
  .method-item {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 12px;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 12px;
    align-items: center;
  }
  .method-sig {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--sf-blue);
  }
  .method-remove {
    background: transparent;
    border: 1px solid rgba(194,57,52,0.4);
    color: #FF6B6B;
    font-size: 9px;
    padding: 4px 10px;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: var(--display);
    font-weight: 700;
    letter-spacing: 0.1em;
  }
  .method-remove:hover {
    background: rgba(194,57,52,0.15);
    border-color: #FF6B6B;
  }

  .add-method-btn {
    background: transparent;
    border: 1px dashed var(--border);
    color: var(--muted);
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
  }
  .add-method-btn:hover {
    border-color: var(--sf-blue);
    color: var(--sf-blue);
    border-style: solid;
  }

  .generate-btn {
    background: var(--sf-blue);
    color: var(--bg);
    border: none;
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 14px 32px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
    width: 100%;
    margin-top: 8px;
  }
  .generate-btn:hover {
    background: #30B8F0;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,161,224,0.3);
  }

  /* MULESOFT HANDBOOK */
  .edge-case-card {
    background: var(--surface);
    border-left: 4px solid var(--sf-lightning);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 24px;
  }
  .edge-case-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 16px;
  }
  .edge-case-icon {
    width: 44px;
    height: 44px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
    background: rgba(255,183,93,0.15);
    border: 1px solid var(--sf-lightning);
  }
  .edge-case-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 14px;
    color: var(--text);
    margin-bottom: 6px;
  }
  .edge-case-scenario {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }
  .solution-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0;
  }
  .solution-tab {
    padding: 8px 16px;
    font-size: 10px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    font-family: var(--display);
    font-weight: 700;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.15s;
  }
  .solution-tab:hover { color: var(--text); }
  .solution-tab.active { color: var(--sf-blue); border-bottom-color: var(--sf-blue); }
  .solution-content { display: none; padding: 16px 0; }
  .solution-content.active { display: block; }
  .solution-content h4 {
    font-family: var(--display);
    font-weight: 700;
    font-size: 11px;
    color: var(--sf-blue);
    margin-bottom: 10px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .solution-content p {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.7;
    margin-bottom: 12px;
  }
  .solution-content ul {
    list-style: none;
    display: grid;
    gap: 6px;
    margin: 12px 0;
  }
  .solution-content li {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    display: flex;
    align-items: flex-start;
    gap: 10px;
  }
  .solution-content li::before {
    content: '‚Üí';
    color: var(--sf-blue);
    flex-shrink: 0;
    margin-top: 2px;
  }

  .best-practice-section {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 20px;
  }
  .bp-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }
  .bp-icon {
    font-size: 24px;
  }
  .bp-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 13px;
    color: var(--text);
  }
  .bp-list {
    display: grid;
    gap: 12px;
  }
  .bp-item {
    display: grid;
    grid-template-columns: 24px 1fr;
    gap: 12px;
    align-items: start;
  }
  .bp-check {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    background: rgba(6,214,112,0.15);
    color: #06D670;
    border: 1px solid #06D670;
    flex-shrink: 0;
    margin-top: 2px;
  }
  .bp-text {
    font-size: 11px;
    color: var(--text);
    line-height: 1.6;
  }
  .bp-detail {
    font-size: 10px;
    color: var(--muted);
    margin-top: 4px;
    line-height: 1.5;
  }

  .warning-box {
    background: rgba(194,57,52,0.08);
    border-left: 3px solid var(--sf-red);
    border-radius: 3px;
    padding: 14px 16px;
    margin: 16px 0;
  }
  .warning-box-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    color: #FF6B6B;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .warning-box-text {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }

  .info-box {
    background: rgba(0,161,224,0.06);
    border-left: 3px solid var(--sf-blue);
    border-radius: 3px;
    padding: 14px 16px;
    margin: 16px 0;
  }
  .info-box-title {
    font-family: var(--display);
    font-weight: 700;
    font-size: 10px;
    color: var(--sf-blue);
    letter-spacing: 0.12em;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .info-box-text {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
  }

  /* LWC LIFECYCLE GRID */
  .lifecycle-grid {
    display: grid;
    gap: 16px;
    margin-bottom: 24px;
  }
  .lifecycle-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 18px;
    transition: border-color 0.2s;
  }
  .lifecycle-card:hover { border-color: rgba(0,161,224,0.4); }
  .lifecycle-name {
    font-family: var(--display);
    font-weight: 700;
    font-size: 12px;
    color: var(--sf-blue);
    margin-bottom: 8px;
  }
  .lifecycle-when {
    font-size: 10px;
    color: var(--sf-lightning);
    margin-bottom: 10px;
    font-style: italic;
  }
  .lifecycle-desc {
    font-size: 11px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 12px;
  }
  .lifecycle-use {
    font-size: 10px;
    color: var(--text);
    background: rgba(0,161,224,0.06);
    padding: 8px 12px;
    border-radius: 3px;
    border-left: 2px solid var(--sf-blue);
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  @media (max-width: 768px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar { position: static; height: auto; display: flex; flex-wrap: wrap; padding: 12px; gap: 4px; }
    .nav-item { padding: 8px 12px; border-left: none; border-bottom: 2px solid transparent; }
    .nav-item.active { border-left: none; border-bottom-color: var(--sf-blue); }
    .content { padding: 24px 20px; }
    .soql-row { grid-template-columns: 1fr; }
    .limit-row { grid-template-columns: 1fr auto; }
    .limit-bar-wrap { display: none; }
  }

</style>
</head>
<body>

<header class="header">
  <div class="logo-ring">‚ö°</div>
  <div>
    <div class="header-title">SF DEV TOOLKIT</div>
    <div class="header-sub">Apex ¬∑ SOQL ¬∑ LWC ¬∑ Patterns</div>
  </div>
  <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle dark/light mode">
    <span class="theme-icon" id="theme-icon">‚òÄÔ∏è</span>
  </button>
  <div class="version-badge">API v62.0</div>
</header>

<div class="layout">

  <nav class="sidebar">
    <div class="sidebar-section">Core</div>
    <a href="governor-limits.html" class="nav-item">
      <span class="nav-dot"></span>Governor Limits
    </a>
    <a href="apex-patterns.html" class="nav-item">
      <span class="nav-dot"></span>Apex Patterns
    </a>
    <a href="soql-builder.html" class="nav-item">
      <span class="nav-dot"></span>SOQL Builder
    </a>
    <a href="apex-builder.html" class="nav-item">
      <span class="nav-dot"></span>Apex Builder
    </a>
    <div class="sidebar-section">Architecture</div>
    <a href="decision-matrix.html" class="nav-item">
      <span class="nav-dot"></span>Decision Matrix
    </a>
    <a href="trigger-framework.html" class="nav-item">
      <span class="nav-dot"></span>Trigger Framework
    </a>
    <a href="lwc-patterns.html" class="nav-item">
      <span class="nav-dot"></span>LWC Patterns
    </a>
    <div class="sidebar-section">Quality</div>
    <a href="code-review.html" class="nav-item">
      <span class="nav-dot"></span>Code Review
    </a>
    <a href="test-patterns.html" class="nav-item">
      <span class="nav-dot"></span>Test Patterns
    </a>
    <div class="sidebar-section">Integrations</div>
    <a href="mulesoft-handbook.html" class="nav-item active">
      <span class="nav-dot"></span>MuleSoft Handbook
    </a>
    <a href="metadata-api.html" class="nav-item">
      <span class="nav-dot"></span>Metadata API
    </a>
    <a href="flow-debugging.html" class="nav-item">
      <span class="nav-dot"></span>Flow Debugging
    </a>
    <a href="integration-patterns.html" class="nav-item">
      <span class="nav-dot"></span>Integration Patterns
    </a>
  </nav>

  <main class="content">
    <section class="panel active" id="mule-handbook">

      <div class="panel-header">
        <div class="panel-eyebrow">Integration Deep Dive</div>
        <div class="panel-title">MuleSoft ‚Üî Salesforce Handbook</div>
        <div class="panel-desc">Edge cases, pitfalls, and battle-tested patterns for MuleSoft-Salesforce integrations. What to solve in Mule vs. Salesforce, and how to avoid the common traps.</div>
      </div>

      <!-- EDGE CASE 1 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">‚ö†Ô∏è</div>
          <div>
            <div class="edge-case-title">Edge Case: Platform Event Replay After Mule Downtime</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft subscriber goes offline for 30 minutes. When it reconnects, it misses 200 events published during downtime. Platform Events only retain events for 24-72 hours depending on event type. How do you guarantee no data loss?
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'replay-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'replay-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="replay-mule">
          <h4>MuleSoft Solution: Pub/Sub API with Durable Subscription</h4>
          <p>Use the Salesforce Pub/Sub API (gRPC) with a durable subscription. Each subscriber maintains a replay ID cursor. When Mule reconnects, it automatically resumes from the last processed event.</p>
          <ul>
            <li>Configure MuleSoft to use gRPC Pub/Sub API instead of CometD Streaming API</li>
            <li>Store the last successful replay ID in a persistent store (database, Redis)</li>
            <li>On reconnect, resume from stored replay ID</li>
            <li>Set replay preset to CUSTOM and pass the stored replay ID</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Why This Works</div>
            <div class="info-box-text">Pub/Sub API maintains event retention for 24-72 hours. Durable subscriptions survive Mule restarts. You can replay missed events as long as they're within retention window.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="replay-sf">
          <h4>Salesforce Solution: Change Data Capture + Batch Recovery</h4>
          <p>Instead of Platform Events, use Change Data Capture. CDC provides a guaranteed replay buffer. Combine with a nightly batch job as safety net.</p>
          <ul>
            <li>Enable Change Data Capture on critical objects instead of Platform Events</li>
            <li>CDC retains all changes for 3 days minimum (up to 30 days with Event Relay)</li>
            <li>Build an Apex Batch job that runs hourly to sync any records updated in last 2 hours</li>
            <li>Batch job acts as reconciliation ‚Äî catches anything Mule missed</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Trade-off</div>
            <div class="warning-box-text">CDC has longer retention but higher licensing cost. Batch job adds complexity. Use this when missing events has severe business impact (financial transactions, compliance data).</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 2 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">üîÑ</div>
          <div>
            <div class="edge-case-title">Edge Case: Circular Update Loop (SF ‚Üí Mule ‚Üí SF)</div>
            <div class="edge-case-scenario">
              Scenario: Opportunity update in Salesforce triggers Platform Event ‚Üí MuleSoft enriches data from ERP ‚Üí Mule upserts back to SF ‚Üí this triggers another Platform Event ‚Üí infinite loop crashes both systems.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'loop-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'loop-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="loop-mule">
          <h4>MuleSoft Solution: Idempotency Header + Correlation ID</div>
          <p>Add a custom header to every Mule ‚Üí SF upsert request. Salesforce trigger checks this header and skips Platform Event publish if present.</p>
          <ul>
            <li>Mule sets HTTP header: <code>X-Integration-Source: MuleSoft</code></li>
            <li>Mule sets unique correlation ID: <code>X-Correlation-Id: uuid</code></li>
            <li>Salesforce trigger checks <code>Request.getCurrent().getHeader('X-Integration-Source')</code></li>
            <li>If header equals 'MuleSoft', skip Platform Event publish</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Limitation</div>
            <div class="warning-box-text">This only works for API-based updates. If Mule uses Bulk API 2.0, headers are not available in triggers. Use Salesforce solution instead.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="loop-sf">
          <h4>Salesforce Solution: Integration User + Bypass Flag</h4>
          <p>Create a dedicated Integration User for Mule. Trigger checks running user and skips Platform Event publish if it's the integration user.</p>
          <ul>
            <li>Create Salesforce user: <code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b2dfc7ded7c1ddd4c69cdbdcc6d7d5c0d3c6dbdddcf2cbddc7c0d1dddfc2d3dccb9cd1dddf">[email&#160;protected]</a></code></li>
            <li>Grant this user a custom Permission Set: <code>Integration_User_Bypass</code></li>
            <li>In trigger: <code>if (!FeatureManagement.checkPermission('Integration_User_Bypass')) { publishEvent(); }</code></li>
            <li>All Mule API calls authenticate as this user</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Best Practice</div>
            <div class="info-box-text">This pattern scales well. Works with Bulk API, REST API, and SOAP API. Easy to audit ‚Äî all integration updates show as single user in field history.</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 3 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">‚è±Ô∏è</div>
          <div>
            <div class="edge-case-title">Edge Case: Bulk API Job Exceeds 24-Hour Processing Time</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft submits a Bulk API 2.0 job with 5 million records. Salesforce takes 26 hours to process it. Job times out. You lose partial results and can't easily identify which records failed.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'bulk-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'bulk-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="bulk-mule">
          <h4>MuleSoft Solution: Chunking + Parallel Job Submission</h4>
          <p>Split the 5M records into 50 separate Bulk API jobs of 100k each. Submit them in parallel with max concurrency of 10 jobs at a time.</p>
          <ul>
            <li>Use DataWeave to split CSV into 100k-row chunks</li>
            <li>Submit each chunk as separate Bulk API job</li>
            <li>Use Scatter-Gather pattern with 10 parallel routes</li>
            <li>Poll each job independently until complete</li>
            <li>Aggregate failed records from all jobs into single retry file</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Performance Gain</div>
            <div class="info-box-text">10 parallel jobs finish in ~3 hours vs. 1 massive job taking 26+ hours. Easier to retry small failed chunks. Each job stays well under 24hr limit.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="bulk-sf">
          <h4>Salesforce Solution: Apex Batch + Platform Events for Progress</h4>
          <p>Don't use Bulk API for data already in Salesforce. Use Apex Batch to process in chunks with progress tracking via Platform Events.</p>
          <ul>
            <li>Mule triggers an Apex REST endpoint to initiate batch job</li>
            <li>Apex Batch processes records in 200-record chunks (well under governor limits)</li>
            <li>Each chunk publishes a Progress Platform Event with success/failure count</li>
            <li>Mule subscribes to progress events and monitors completion</li>
            <li>No 24-hour timeout risk ‚Äî Batch Apex has separate limits</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">When to Use</div>
            <div class="warning-box-text">Only use this if data is already in Salesforce. For external ‚Üí SF data loads, Mule chunking is faster. Apex Batch max: 5 jobs queued at once.</div>
          </div>
        </div>
      </div>

      <!-- EDGE CASE 4 -->
      <div class="edge-case-card">
        <div class="edge-case-header">
          <div class="edge-case-icon">üîê</div>
          <div>
            <div class="edge-case-title">Edge Case: OAuth Token Expires Mid-Job (15-minute Expiry)</div>
            <div class="edge-case-scenario">
              Scenario: MuleSoft starts a long-running process that makes incremental Salesforce API calls over 2 hours. After 15 minutes, the OAuth access token expires. Subsequent API calls fail with 401 Unauthorized. Entire process crashes.
            </div>
          </div>
        </div>
        <div class="solution-tabs">
          <div class="solution-tab active" onclick="toggleSolution(this, 'token-mule')">Solve in Mule</div>
          <div class="solution-tab" onclick="toggleSolution(this, 'token-sf')">Solve in Salesforce</div>
        </div>
        <div class="solution-content active" data-solution="token-mule">
          <h4>MuleSoft Solution: Proactive Token Refresh with Interceptor</h4>
          <p>Implement a custom Mule interceptor that checks token expiry before each API call and refreshes proactively.</p>
          <ul>
            <li>Store token metadata: <code>{ access_token, issued_at, expires_in }</code></li>
            <li>Before each SF API call, check: <code>if (now - issued_at > expires_in - 60s) refresh()</code></li>
            <li>Refresh 60 seconds before actual expiry (safety buffer)</li>
            <li>Use OAuth refresh token flow: <code>POST /services/oauth2/token</code> with <code>grant_type=refresh_token</code></li>
            <li>Update stored access_token and issued_at atomically</li>
          </ul>
          <div class="info-box">
            <div class="info-box-title">Recommended Approach</div>
            <div class="info-box-text">This prevents all 401 errors. MuleSoft Salesforce Connector handles this automatically, but if using HTTP Request connector, implement this manually.</div>
          </div>
        </div>
        <div class="solution-content" data-solution="token-sf">
          <h4>Salesforce Solution: Use Session ID with Connected App</h4>
          <p>Instead of OAuth access tokens (15-min expiry), use Salesforce Session ID which lasts 2+ hours (configurable up to 12 hours).</p>
          <ul>
            <li>Mule authenticates via SOAP login() call instead of OAuth</li>
            <li>SOAP login returns sessionId with much longer expiry</li>
            <li>Configure Session Settings in Salesforce: Setup ‚Üí Session Settings ‚Üí Timeout = 12 hours</li>
            <li>sessionId valid for entire session duration</li>
          </ul>
          <div class="warning-box">
            <div class="warning-box-title">Security Trade-off</div>
            <div class="warning-box-text">Session IDs are less secure than short-lived OAuth tokens. Only use for trusted internal integrations. Not recommended for public-facing APIs.</div>
          </div>
        </div>
      </div>

      <!-- BEST PRACTICES SECTION -->
      <div style="font-size:11px;letter-spacing:0.15em;text-transform:uppercase;color:var(--muted);margin:40px 0 20px;font-weight:700;border-top:1px solid var(--border);padding-top:24px;">üìã MuleSoft ‚Üî Salesforce Best Practices</div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">üîê</div>
          <div class="bp-title">Authentication & Security</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Use OAuth 2.0 JWT Bearer flow (not username-password)</div>
              <div class="bp-detail">Server-to-server auth without user interaction. Rotate certificates annually. Store private keys in secure vault (Anypoint Secrets Manager).</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Create dedicated Integration User with minimal permissions</div>
              <div class="bp-detail">Never use admin credentials. Grant only necessary object/field permissions via Permission Set. Easier to audit and revoke access.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Implement IP whitelisting on both sides</div>
              <div class="bp-detail">Salesforce: Restrict Connected App to Mule's IP range. Mule: Use Anypoint VPC to lock down egress IPs.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">üìä</div>
          <div class="bp-title">Data Sync & Idempotency</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Always upsert by External ID ‚Äî never query-then-insert</div>
              <div class="bp-detail">Mark Integration_Id__c field as externalId=true and unique=true. Mule upserts using this field. Eliminates race conditions and duplicate records.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Design all endpoints to be idempotent</div>
              <div class="bp-detail">Same request processed multiple times produces same result. Use correlation IDs to detect duplicate requests. Store processed IDs in Redis/database with 24hr TTL.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Use Bulk API 2.0 for >2,000 records</div>
              <div class="bp-detail">Bulk API 2.0 is faster and more reliable than REST API for large data volumes. Auto-batches into 10k chunks. Provides per-record success/failure tracking.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Implement delta sync with Last Modified Date</div>
              <div class="bp-detail">Don't sync full dataset every run. Query: <code>WHERE LastModifiedDate > :lastSyncTime</code>. Store last sync timestamp in persistent store. Reduces API consumption by 95%+.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">üö®</div>
          <div class="bp-title">Error Handling & Monitoring</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Never lose data ‚Äî implement DLQ (Dead Letter Queue)</div>
              <div class="bp-detail">Failed records ‚Üí DLQ (persistent queue). Separate process retries DLQ records hourly with exponential backoff. Alert if DLQ size > threshold.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Distinguish transient vs. permanent failures</div>
              <div class="bp-detail">Transient (network timeout, 503): Retry with backoff. Permanent (400 validation error, duplicate): Don't retry, log to error table for manual review.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Set up proactive alerting on key metrics</div>
              <div class="bp-detail">Alert on: API call failures > 5%, Bulk job processing time > 2hr, Platform Event lag > 5 min, OAuth token refresh failures. Use Anypoint Monitoring + PagerDuty.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Log correlation IDs end-to-end for traceability</div>
              <div class="bp-detail">Generate UUID in Mule entry point. Pass as <code>X-Correlation-Id</code> header to all downstream calls. Log it in Salesforce triggers. Enables tracing request across both systems.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="best-practice-section">
        <div class="bp-header">
          <div class="bp-icon">‚ö°</div>
          <div class="bp-title">Performance & Scalability</div>
        </div>
        <div class="bp-list">
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Use Parallel Processing for independent operations</div>
              <div class="bp-detail">Scatter-Gather pattern: Query 3 objects in parallel vs. sequentially. Reduces total latency by 60%+. Max 10 parallel routes to avoid overwhelming SF.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Cache reference data (RecordTypes, Picklists) in Mule</div>
              <div class="bp-detail">Don't query RecordTypeId on every record. Cache in Object Store with 24hr TTL. Refresh cache daily via scheduled flow. Saves 1000s of SOQL queries.</div>
            </div>
          </div>
          <div class="bp-item">
            <div class="bp-check">‚úì</div>
            <div>
              <div class="bp-text">Throttle API calls to stay under rate limits</div>
              <div class="bp-detail">SF rate limit: 100 API calls/user/20s. Use Rate Limiting policy in Anypoint to enforce 80 calls/20s per user. Prevents 503 errors during peak load.</div>
            </div>
          </div>
        </div>
      </div>

      <div class="code-card">
        <div class="code-header">
          <span class="code-label">Complete Mule Flow Example ‚Äî Idempotent Upsert with Error Handling</span>
          <span class="code-tag tag-info">Mule DSL</span>
        </div>
        <pre><span class="op">&lt;</span><span class="cls">flow</span> name=<span class="str">"sync-accounts-to-salesforce"</span><span class="op">&gt;</span>
  <span class="cmt">&lt;!-- 1. Generate correlation ID for tracing --&gt;</span>
  <span class="op">&lt;</span><span class="cls">set-variable</span> variableName=<span class="str">"correlationId"</span> 
                value=<span class="str">"#[uuid()]"</span> /&gt;
  
  <span class="cmt">&lt;!-- 2. Transform ERP data to Salesforce format --&gt;</span>
  <span class="op">&lt;</span><span class="cls">ee:transform</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">ee:message</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">ee:set-payload</span><span class="op">&gt;</span>
        %dw 2.0
        output application/json
        ---
        payload map {
          Integration_Id__c: $.erpAccountId,
          Name: $.accountName,
          BillingStreet: $.address.street,
          AnnualRevenue: $.revenue as Number,
          <span class="cmt">// Correlation ID for idempotency check in SF</span>
          Correlation_Id__c: vars.correlationId
        }
      <span class="op">&lt;/</span><span class="cls">ee:set-payload</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">ee:message</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">ee:transform</span><span class="op">&gt;</span>
  
  <span class="cmt">&lt;!-- 3. Upsert with External ID --&gt;</span>
  <span class="op">&lt;</span><span class="cls">try</span><span class="op">&gt;</span>
    <span class="op">&lt;</span><span class="cls">salesforce:upsert</span>
      config-ref=<span class="str">"Salesforce_Config"</span>
      type=<span class="str">"Account"</span>
      externalIdFieldName=<span class="str">"Integration_Id__c"</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>#[payload]<span class="op">&lt;/</span><span class="cls">salesforce:records</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">salesforce:upsert</span><span class="op">&gt;</span>
    
    <span class="cmt">&lt;!-- 4. Log success --&gt;</span>
    <span class="op">&lt;</span><span class="cls">logger</span> level=<span class="str">"INFO"</span> 
             message=<span class="str">"#['Upserted ' ++ sizeOf(payload) ++ ' accounts. Correlation: ' ++ vars.correlationId]"</span> /&gt;
    
    <span class="cmt">&lt;!-- 5. Error handling --&gt;</span>
    <span class="op">&lt;</span><span class="cls">error-handler</span><span class="op">&gt;</span>
      <span class="op">&lt;</span><span class="cls">on-error-propagate</span> type=<span class="str">"SALESFORCE:CONNECTIVITY"</span><span class="op">&gt;</span>
        <span class="cmt">&lt;!-- Transient error - send to retry queue --&gt;</span>
        <span class="op">&lt;</span><span class="cls">jms:publish</span> destination=<span class="str">"salesforce-retry-queue"</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">jms:message</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="cls">jms:body</span><span class="op">&gt;</span>#[payload]<span class="op">&lt;/</span><span class="cls">jms:body</span><span class="op">&gt;</span>
            <span class="op">&lt;</span><span class="cls">jms:properties</span><span class="op">&gt;</span>
              #[{ correlationId: vars.correlationId, retryCount: 0 }]
            <span class="op">&lt;/</span><span class="cls">jms:properties</span><span class="op">&gt;</span>
          <span class="op">&lt;/</span><span class="cls">jms:message</span><span class="op">&gt;</span>
        <span class="op">&lt;/</span><span class="cls">jms:publish</span><span class="op">&gt;</span>
      <span class="op">&lt;/</span><span class="cls">on-error-propagate</span><span class="op">&gt;</span>
      
      <span class="op">&lt;</span><span class="cls">on-error-propagate</span> type=<span class="str">"SALESFORCE:INVALID_DATA"</span><span class="op">&gt;</span>
        <span class="cmt">&lt;!-- Permanent error - log to DLQ for manual review --&gt;</span>
        <span class="op">&lt;</span><span class="cls">db:insert</span> config-ref=<span class="str">"Database_Config"</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">db:sql</span><span class="op">&gt;</span>
            INSERT INTO error_log (correlation_id, error_type, payload, timestamp)
            VALUES (:correlationId, :errorType, :payload, NOW())
          <span class="op">&lt;/</span><span class="cls">db:sql</span><span class="op">&gt;</span>
          <span class="op">&lt;</span><span class="cls">db:input-parameters</span><span class="op">&gt;</span>
            #[{
              correlationId: vars.correlationId,
              errorType: 'VALIDATION_ERROR',
              payload: write(payload, 'application/json')
            }]
          <span class="op">&lt;/</span><span class="cls">db:input-parameters</span><span class="op">&gt;</span>
        <span class="op">&lt;/</span><span class="cls">db:insert</span><span class="op">&gt;</span>
      <span class="op">&lt;/</span><span class="cls">on-error-propagate</span><span class="op">&gt;</span>
    <span class="op">&lt;/</span><span class="cls">error-handler</span><span class="op">&gt;</span>
  <span class="op">&lt;/</span><span class="cls">try</span><span class="op">&gt;</span>
<span class="op">&lt;/</span><span class="cls">flow</span><span class="op">&gt;</span></pre>
      </div>

    
    </section>
  </main>
</div>

<script>

</script>
</body>
</html>
